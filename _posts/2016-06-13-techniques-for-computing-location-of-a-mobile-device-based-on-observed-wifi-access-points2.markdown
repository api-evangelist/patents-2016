---

title: Techniques for computing location of a mobile device based on observed Wi-Fi access points
abstract: In one embodiment, scanning data is received for wireless access points whose wireless signals were observed by the one or more scanning devices in a target area. For each group of scanning data that shares a common identifier of a Wi-Fi access point, a centroid of the scanning data is determined, a set of scanning data of the group that exceeds a threshold distance from the centroid is designated as having potential error, and a location of the Wi-Fi access point is calculated. The calculated location of the Wi-Fi access point for each group of scanning data is stored in a reference database. Upon receiving a request for a location of a mobile device, an identity of one or more Wi-Fi access points in range of the mobile device is determined, and the location of the mobile device is computed using calculated locations from the reference database.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09554247&OS=09554247&RS=09554247
owner: Skyhook Wireless, Inc.
number: 09554247
owner_city: Boston
owner_country: US
publication_date: 20160613
---
This application is a continuation of prior U.S. patent application Ser. No. 14 456 310 entitled Techniques for Computing Location of a Mobile Device Based on Observed Wi Fi Access Points filed Aug. 11 2014 which is itself a continuation of U.S. patent application Ser. No. 13 225 848 now U.S. Pat. No. 8 837 363 entitled Server for Updating Location Beacon Database filed Sep. 6 2011 which is itself a continuation of prior U.S. patent application Ser. No. 12 190 683 now U.S. Pat. No. 8 031 657 entitled Server for Updating Location Beacon Database filed Aug. 13 2008 which is itself a continuation of prior U.S. patent application Ser. No. 11 261 898 now U.S. Pat. No. 7 414 988 filed Oct. 28 2005 entitled Server For Updating Location Beacon Database which claims the benefit under 35 U.S.C. 119 e of U.S. Provisional Patent Application No. 60 623 108 filed Oct. 29 2004 entitled Wireless Data Scanning Network for Building Location Beacon Database all of which are herein incorporated by reference in their entirety.

U.S. patent application Ser. No. 11 261 848 now U.S. Pat. No. 7 433 694 filed Oct. 28 2005 entitled Location Beacon Database 

U.S. patent application Ser. No. 11 261 988 now U.S. Pat. No. 7 305 245 filed on Oct. 28 2005 entitled Location Based Services That Choose Location Algorithms Based On Number Of Detected Access Points Within Range Of User Device 

U.S. patent application Ser. No. 11 261 987 now U.S. Pat. No. 7 403 762 filed Oct. 28 2005 entitled Method and System for Building a Location Beacon Database 

U.S. patent application Ser. No. 11 950 178 now U.S. Pat. No. 7 769 396 filed Dec. 4 2007 entitled Location Based Services That Choose Location Algorithms Based On Number Of Detected Access Points Within Range Of User Device and

U.S. patent application Ser. No. 11 950 242 now U.S. Pat. No. 7 818 017 filed Dec. 4 2007 entitled Location Based Services That Choose Location Algorithms Based On Number Of Detected Wireless Signal Stations Within Range Of User Device.

The invention generally related to location based services and more specifically to methods and systems of determining locations of Wi Fi access points and using such information to locate a Wi Fi enabled device.

In recent years the number of mobile computing devices has increased dramatically creating the need for more advanced mobile and wireless services. Mobile email walkie talkie services multi player gaming and call following are examples of how new applications are emerging on mobile devices. In addition users are beginning to demand seek applications that not only utilize their current location but also share that location information with others. Parents wish to keep track of their children supervisors need to track the location of the company s delivery vehicles and a business traveler looks to find the nearest pharmacy to pick up a prescription. All of these examples require the individual to know their own current location or that of someone else. To date we all rely on asking for directions calling someone to ask their whereabouts or having workers check in from time to time with their position.

Location based services are an emerging area of mobile applications that leverages the ability of new devices to calculate their current geographic position and report that to a user or to a service. Some examples of these services include local weather traffic updates driving directions child trackers buddy finders and urban concierge services. These new location sensitive devices rely on a variety of technologies that all use the same general concept. Using radio signals coming from known reference points these devices can mathematically calculate the user s position relative to these reference points. Each of these approaches has its strengths and weaknesses based on the radio technology and the positioning algorithms they employ.

The Global Positioning System GPS operated by the US Government leverages dozens of orbiting satellites as reference points. These satellites broadcast radio signals that are picked up by GPS receivers. The receivers measure the time it took for that signal to reach to the receiver. After receiving signals from three or more GPS satellites the receiver can triangulate its position on the globe. For the system to work effectively the radio signals must reach the received with little or no interference. Weather buildings or structures and foliage can cause interference because the receivers require a clear line of sight to three or more satellites. Interference can also be caused by a phenomenon known as multi path. The radio signals from the satellites bounce off physical structures causing multiple signals from the same satellite to reach a receiver at different times. Since the receiver s calculation is based on the time the signal took to reach the receiver multi path signals confuse the receiver and cause substantial errors.

Cell tower triangulation is another method used by wireless and cellular carriers to determine a user or device s location. The wireless network and the handheld device communicate with each other to share signal information that the network can use to calculate the location of the device. This approach was originally seen as a superior model to GPS since these signals do not require direct line of site and can penetrate buildings better. Unfortunately these approaches have proven to be suboptimal due to the heterogeneous nature of the cellular tower hardware along with the issues of multi path signals and the lack of uniformity in the positioning of cellular towers.

Assisted GPS is a newer model that combines both GPS and cellular tower techniques to produce a more accurate and reliable location calculation for mobile users. In this model the wireless network attempts to help GPS improve its signal reception by transmitting information about the clock offsets of the GPS satellites and the general location of the user based on the location of the connected cell tower. These techniques can help GPS receivers deal with weaker signals that one experiences indoors and helps the receiver obtain a fix on the closest satellites quicker providing a faster first reading . These systems have been plagued by slow response times and poor accuracy greater than 100 meters in downtown areas.

There have been some more recent alternative models developed to try and address the known issues with GPS A GPS and cell tower positioning. One of them known as TV GPS utilizes signals from television broadcast towers. See e.g. Muthukrishnan Maria Lijding Paul Havinga Towards Smart Surroundings Enabling Techniques and Technologies for Localization Lecture Notes in Computer Science Volume 3479 January 2 Hazas M. Scott J. Krumm J. Location Aware Computing Comes of Age. IEEE Computer 37 2 95 97 February 2004 005 Pa005 Pages 350 362. The concept relies on the fact that most metropolitan areas have 3 or more TV broadcast towers. A proprietary hardware chip receives TV signals from these various towers and uses the known positions of these towers as reference points. The challenges facing this model are the cost of the new hardware receiver and the limitations of using such a small set of reference points. For example if a user is outside the perimeter of towers the system has a difficult time providing reasonable accuracy. The classic example is a user along the shoreline. Since there are no TV towers out in the ocean there is no way to provide reference symmetry among the reference points resulting in a calculated positioning well inland of the user.

Microsoft Corporation and Intel Corporation via a research group known as PlaceLab have deployed a Wi Fi Location system using the access point locations acquired from amateur scanners known as wardrivers who submit their Wi Fi scan data to public community web sites. See e.g. LaMarca A. et. al. Place Lab Device Positioning Using Radio Beacons in the Wild. Examples include WiGLE Wi FiMaps.com Netstumbler.com and NodeDB. Both Microsoft and Intel have developed their own client software that utilizes this public wardriving data as reference locations. Because individuals voluntarily supply the data the systems suffer a number of performance and reliability problems. First the data across the databases are not contemporaneous some of the data is new while other portions are 3 4 years old. The age of the access point location is important since over time access points can be moved or taken offline. Second the data is acquired using a variety of hardware and software configurations. Every 802.11 radio and antenna has different signal reception characteristics affecting the representation of the strength of the signal. Each scanning software implementation scans for Wi Fi signals in different ways during different time intervals. Third the user supplied data suffers from arterial bias. Because the data is self reported by individuals who are not following designed scanning routes the data tends to aggregate around heavily traffic areas. Arterial bias causes a resulting location pull towards main arteries regardless of where the user is currently located causing substantial accuracy errors. Fourth these databases include the calculated position of scanned access points rather than the raw scanning data obtained by the 802.11 hardware. Each of these databases calculates the access point location differently and each with a rudimentary weighted average formula. The result is that many access points are indicated as being located far from their actual locations including some access points being incorrectly indicated as if they were located in bodies of water.

There have been a number of commercial offerings of Wi Fi location systems targeted at indoor positioning. See e.g. Kavitha Muthukrishnan Maria Lijding Paul Havinga Towards Smart Surroundings Enabling Techniques and Technologies for Localization Lecture Notes in Computer Science Volume 3479 January 2 Hazas M. Scott J. Krumm J. Location Aware Computing Comes of Age. IEEE Computer 37 2 95 97 February 2004 005 Pa005 Pages 350 362. These systems are designed to address asset and people tracking within a controlled environment like a corporate campus a hospital facility or a shipping yard. The classic example is having a system that can monitor the exact location of the crash cart within the hospital so that when there is a cardiac arrest the hospital staff doesn t waste time locating the device. The accuracy requirements for these use cases are very demanding typically calling for 1 3 meter accuracy. These systems use a variety of techniques to fine tune their accuracy including conducting detailed site surveys of every square foot of the campus to measure radio signal propagation. They also require a constant network connection so that the access point and the client radio can exchange synchronization information similar to how A GPS works. While these systems are becoming more reliable for these indoor use cases they are ineffective in any wide area deployment. It is impossible to conduct the kind of detailed site survey required across an entire city and there is no way to rely on a constant communication channel with 802.11 access points across an entire metropolitan area to the extent required by these systems. Most importantly outdoor radio propagation is fundamentally different than indoor radio propagation rendering these indoor positioning algorithms almost useless in a wide area scenario.

There are numerous 802.11 location scanning clients available that record the presence of 802.11 signals along with a GPS location reading. These software applications are operated manually and produce a log file of the readings.

Examples of these applications are Netstumber Kismet and Wi FiFoFum. Some hobbyists use these applications to mark the locations of 802.11 access point signals they detect and share them with each other. The management of this data and the sharing of the information is all done manually. These application do not perform any calculation as to the physical location of the access point they merely mark the location from which the access point was detected.

In general in one aspect the invention features a system that includes computer implemented logic to derive position information for each of a plurality of Wi Fi access points in a geographic area having a radius on the order of miles wherein the position information is derived at least in part from sets of data collected during a comprehensive traversal of the geographic area each set of data including signal data characterizing one or more observed characteristics of a signal received from the Wi Fi access point and location data characterizing a location at which the one or more characteristics of the signal received from the Wi Fi access point was observed and computer implemented logic to store the derived position information in a non transitory computer readable medium.

The one or more observed characteristics may include one or more radio characteristics of the signal received from the Wi Fi access point. The geographical area may have a radius on the order of at least tens of miles. The computer implemented logic to store the derived position information may include logic to store the derived position information for a particular Wi Fi access point in association with data representative of an identifier of that Wi Fi access point. The comprehensive traversal of the geographic area may include an exhaustive and or systematic traversal of accessible thoroughfares of the geographic area. The computer implemented logic to derive the position information may include logic to derive position information from a combination of newly collected sets of data and previously collected sets of data.

The system may further include computer implemented logic to identify sets of data with potential error. The computer implemented logic to derive the position information may include logic to exclude the identified sets of data with potential error from the sets of data from which the position information is derived. The system may further include computer implemented logic to identify a portion of the geographic area in which the identified sets of data with potential error was collected. The system may further include computer implemented logic to identify as a group sets of data that share a common identifier of a Wi Fi access point and perform clustering analysis of the sets of data of the identified group and based on results of the analysis designate one or more sets of data of the identified group as sets of data with potential error. The logic to perform clustering analysis may include logic to determine a first centroid for the Wi Fi access point based at least in part on the sets of data of the identified group and designate a first set of data as a set of data with potential error if a comparison of a distance between the first centroid and the location data of the first set of data exceeds a threshold. The logic to perform clustering analysis may include logic to determine a weighted centroid for the Wi Fi access point based at least in part on the age of the location data of the sets of data of the identified group and designate a first set of data as a set of data with potential error if a comparison of a distance between the weighted centroid and the location data of the first set of data exceeds a threshold.

The system may further include a collection of information in the non transitory computer readable medium the collection of information describing the plurality of Wi Fi access points in the geographic area. The plurality of Wi Fi access points in the geographic area may include substantially all of the Wi Fi access points in the geographic area.

The sets of data that share a common identifier of a Wi Fi access point may provide reference symmetry when the position information for the Wi Fi access point is derived.

The sets of data that share a common identifier of a Wi Fi access point may reduce arterial bias when the position information for the Wi Fi access point is derived.

The system may further include computer implemented logic to identify at least one portion of the geographic area in which no position information for a Wi Fi access point is derived.

In general in another aspect the invention features a computer implemented method that includes deriving position information for each of a plurality of Wi Fi access points in a geographic area having a radius on the order of miles wherein the position information is derived at least in part from sets of data collected during a comprehensive traversal of the geographic area each set of data including signal data characterizing one or more observed characteristics of a signal received from the Wi Fi access point and location data characterizing a location at which the one or more characteristics of the signal received from the Wi Fi access point was observed and storing the derived position information in a non transitory computer readable medium.

The one or more observed characteristics may include one or more radio characteristics of the signal received from the Wi Fi access point. The geographical area may have a radius on the order of at least tens of miles. The method of storing the derived position information may include storing the derived position information for a particular Wi Fi access point in association with data representative of an identifier of that Wi Fi access point. The comprehensive traversal of the geographic area may include an exhaustive and or systematic traversal of accessible thoroughfares of the geographic area.

The method of deriving the position information may include deriving position information from a combination of newly collected sets of data and previously collected sets of data. The method may further include identifying sets of data with potential error. The method of deriving the position information may include excluding the identified sets of data with potential error from the sets of data from which the position information is derived. The method may further include identifying a portion of the geographic area in which the identified sets of data with potential error was collected. The method may further include identifying as a group sets of data that share a common identifier of a Wi Fi access point and performing clustering analysis of the sets of data of the identified group and based on results of the analysis designating one or more sets of data of the identified group as sets of data with potential error. The method of performing clustering analysis may include determining a first centroid for the Wi Fi access point based at least in part on the sets of data of the identified group and designating a first set of data as a set of data with potential error if a comparison of a distance between the first centroid and the location data of the first set of data exceeds a threshold. The method of performing clustering analysis may include determining a weighted centroid for the Wi Fi access point based at least in part on the age of the location data of the sets of data of the identified group and designating a first set of data as a set of data with potential error if a comparison of a distance between the weighted centroid and the location data of the first set of data exceeds a threshold. The sets of data that share a common identifier of a Wi Fi access point may provide reference symmetry when deriving the position information for the Wi Fi access point. The sets of data that share a common identifier of a Wi Fi access point may reduce arterial bias when deriving the position information for the Wi Fi access point. The method may further include identifying at least one portion of the geographic area in which no position information for a Wi Fi access point is derived.

In general in another aspect the invention features software embodied in a non transitory computer readable medium including instructions executable by a processor to derive position information for each of a plurality of Wi Fi access points in a geographic area having a radius on the order of miles wherein the position information is derived at least in part from sets of data collected during a comprehensive traversal of the geographic area each set of data including signal data characterizing one or more observed characteristics of a signal received from the Wi Fi access point and location data characterizing a location at which the one or more characteristics of the signal received from the Wi Fi access point was observed and store the derived position information in a non transitory computer readable medium.

The one or more observed characteristics may include one or more radio characteristics of the signal received from the Wi Fi access point. The geographical area may have a radius on the order of at least tens of miles. The instructions executable by the data processor to derive the position information may include instructions to derive position information from a combination of newly collected sets of data and previously collected sets of data. The instructions executable by the data processor to derive the position information may include instructions to excludes sets of data with potential error from the sets of data from which the position information is derived. The software may further include instructions executable by the data processor to identify as a group sets of data that share a common identifier of a Wi Fi access point and perform clustering analysis of the sets of data of the identified group and based on results of the analysis designate one or more sets of data of the identified group as sets of data with potential error. The instructions to perform clustering analysis may include instructions executable by the data processor to determine a first centroid for the Wi Fi access point based at least in part on the sets of data of the identified group and designate a first set of data as a set of data with potential error if a comparison of a distance between the first centroid and the location data of the first set of data exceeds a threshold. The instructions to perform clustering analysis may include instructions executable by the data processor to determine a weighted centroid for the Wi Fi access point based at least in part on the age of the location data of the sets of data of the identified group and designate a first set of data as a set of data with potential error if a comparison of a distance between the weighted centroid and the location data of the first set of data exceeds a threshold.

Other features and advantages of the invention are apparent from the following description and from the claims.

Preferred embodiments of the present invention provide a system and a methodology for gathering reference location data to enable a commercial positioning system using public and private 802.11 access points. Preferably the data is gathered in a programmatic way to fully explore and cover the streets of a target region. The programmatic approach identifies as many Wi Fi access points as possible. By gathering location information about more access points preferred embodiments not only provide a larger collection of location information about access points but the location information for each access point may be calculated with more precision. Subsequently this larger set of more precise data may be used by location services to more precisely locate a user device utilizing preferred embodiments of the invention. Certain embodiments use techniques to avoid erroneous data in determining the Wi Fi positions and use newly discovered position information to improve the quality of previously gathered and determined position information. Certain embodiments use location determination algorithms based on the context of the user device at the time the user requests a location. For example the location determination algorithm will be based on the number of Wi Fi access points identified or detected when a location request is made or based on the application making the request.

The positioning software is described in greater detail with reference to which depict exemplary components of positioning software . Typically there is an application or service that utilizes location readings to provide some value to an end user example driving directions . This location application makes a request of the positioning software for the location of the device at that particular moment. That request initiates the scanner which makes a scan request to the 802.11 radio on the device. The 802.11 radio sends out a probe request to all 802.11 access points within range. According to the 802.11 protocol those access points in receipt of a probe request will transmit a broadcast beacon containing information about the access point. That beacon includes the MAC address of the device the network name the precise version of the protocol that it supports and its security configuration along with information about how to connect to the device. The 802.11 radio collects this information from each access point that responds calculates the signal strength of each access point and sends that back to the scanner.

The scanner passes this array of access points to the Locator which checks the MAC addresses of each observed access point against the Access Point Reference Database . This database can either be located on the device or remotely over a network connection. The Access Point Reference Database returns the location data for each of the observed access points that are known to the system. The Locator passes this collection of location information along with the signal characteristics returned from each access point to the Bad Data Filter . This filter applies a number of comparison tests against each access point to determine if any of the access points have moved since they were added to the access point database. After removing bad data records the Filter sends the remaining access points to the Location Calculation component . Using the reference data from the access point database and the signal strength readings from the Scanner the Location Calculation component computes the location of the device at that moment. Before that location data is sent back to the Locator it is processed by the Smoothing engine which averages a past series of location readings to remove any erratic readings from the previous calculation. The adjusted location data is then sent back to the Locator.

The calculated location readings produced by the Locator are communicated to these location based applications through the Application Interface which includes an application programming interface API or via a virtual GPS capability . GPS receivers communicate their location readings using proprietary messages or using the location standard like the one developed by the National Marine Electronics Association NMEA . Connecting into the device using a standard interface such as a COM port on the machine retrieves the messages. Certain embodiments of the invention include a virtual GPS capability that allows any GPS compatible application to communicate with this new positioning system without have to alter the communication model or messages.

The location calculations are produced using a series of positioning algorithms intended to turn noisy data flows into reliable and steady location readings. The client software compares the list of observed access points along with their calculated signal strengths to weight the location of user to determine precise location of the device user. A variety of techniques are employed including simple signal strength weighted average models nearest neighbor models combined with triangulation techniques and adaptive smoothing based on device velocity. Different algorithms perform better under different scenarios and tend to be used together in hybrid deployments to product the most accurate final readings. Preferred embodiments of the invention can use a number of positioning algorithms. The decision of which algorithm to use is driven by the number of access points observed and the user case application using it. The filtering models differ from traditional positioning systems since traditional systems rely on known reference points that never move. In the model of preferred embodiments this assumption of fixed locations of access points is not made the access points are not owned by the positioning system so they may move or be taken offline. The filtering techniques assume that some access points may no longer be located in the same place and could cause a bad location calculation. So the filtering algorithms attempt to isolate the access points that have moved since their position was recorded. The filters are dynamic and change based on the number of access points observed at that moment. The smoothing algorithms include simple position averaging as well as advanced bayesian logic including Kalman filters. The velocity algorithms calculate device speed by estimating the Doppler effect from the signal strength observations of each access point.

Another approach is develop routing algorithms that include every single street in the target area so as to avoid arterial bias in the resulting collection of data thus producing a more reliable positioning system for the end users. describes an optimized routing algorithm known as the Chinese Postman to calculate the most efficient driving route for covering every single street in a target area. The Chinese Postman routing algorithm is a known technique used by postal agencies utilities and census agencies and is a variant of the Eulerian cycle problem. The Eulerian cycle is a problem asking for the shortest tour of a graph which visits each edge at least once. See e.g. Kwan M. K. Graphic Programming Using Odd or Even Points. Chinese Math. 1 273 277 1962. Preferred embodiments of the invention include a methodology for identifying a target region for coverage and then using the Chinese Postman routing algorithm for planning the vehicle route. The scanning vehicle follows the optimal route according to the algorithm showing no bias to any street ensuring that all observable access points are detected and mapped by the system. So by way of example access points and are added to the access point database using the Chinese Postman model but would have been missed using the Random model. Referring back to with the Chinese Postman Scanning model the vehicle travels every single road getting as complete a set of scanning records for the Access Point . The system can then calculate the location of the access point with less error since it has a more uniform distribution of scan data for access point than for access . So the Chinese Postman Scanning model not only gathers more access points uniformly across a target area but the resulting data produces more accurate calculations of access point locations.

Once collected or partially collected the scanning data is uploaded back to a central access point database described later in this application where it is processed. The raw observation points for each access point are used to reverse triangulate the actual physical location of the access points or create a power profile representing the radio propagation of that access point. In order to produce the most accurate calculated location for a particular access points or to create the most accurate power profile the scanning vehicle must observe the access point from as many different angles as possible. In the random model many access points are observed from only one street forcing the system to calculate their location directly on the street . These locations exhibit a directional bias and are significantly different than the actual locations of these access points . Errors are introduced into a positioning system when its reference point locations are inaccurate. So in this positioning system the accuracy of the access point locations play a large role in the accuracy of the end user positioning accuracy. Using the Chinese Postman model the scanning vehicles detect a particular access point from as many sides as possible of the building housing the access point. This additional data greatly improves the results of the reverse triangulation formula used to calculate the location of the access points . More details on the access point location quality is described in connection with .

The scanning data collected from this system represents a reliable proxy for the signal propagation pattern for each access point in its specific environment. Every radio device and associated surrounding environment produces a unique signal fingerprint showing how far the signal reaches and how strong the signal is in various locations within the signal fingerprint. This fingerprint data is used in conjunction with the calculated access point location to drive high accuracy for the positioning system. This fingerprint is also known as a power profile since the signal strengths at each position is measured as signal power in watts. The positioning system can interpret the fingerprint data to indicate that a particular signal strength of an 802.11 access point radio is associated with a particular distance from that access point. Signal fingerprinting techniques are used in indoor Wi Fi positioning but have proved difficult to replicate in the wider area outdoor environments because the difficulty associated with collecting the fingerprint data. When the fingerprints or power profiles of multiple access points are overlaid the positioning system can determine a device location merely by finding the one position where the observed signal strengths match the combined fingerprints. Preferred embodiments of this invention provide a reliable system for obtaining this fingerprint data across a massive coverage area with millions of access points in order to utilize fingerprint based positioning algorithms.

Positioning systems typically work by having three or more reference points around the device being tracked. These positioning systems use the radio signals from these reference points in various ways to calculate the device s current location. Significant errors occur when there are an insufficient number of reference points or when the reference points lack balance or symmetry around the user. As illustrated in the arterial bias that emerges from the random model introduces many scenarios where the end user moves into physical areas in which there are only recorded access point locations on one side of them. This lack of symmetry in the distribution of reference points around the end user causes the positioning algorithms to calculate the device location with a great deal of error. With Chinese Postman model of scanning for access points the user typically encounters a physical location in which there are numerous access point locations on all sides of the user within the range of the device s 802.11 radio. The resulting position calculation has reduced location bias and is more accurate as a result. is another example showing the impact of quality location calculations.

The scanning device deployed is a combination of the iPAQ 4155 Pocket PC and Powered GPS PDA Mount Cradle with integrated SiRF II type GPS receiver with XTrac v. 2.0 firmware.

The Scanning Client of certain embodiments is described in connection with . The client consist of three main components the Data Manager the System Manager and the Upload Manager . The Data Manager controls the operations of both the GPS radio and the 802.11 radio . The Data Manager controls when and how often these radios scan for signals and process those signals. The GPS radio once activated receives signals from GPS satellites and calculates its geographic location. The GPS recorder logs all of those readings every second and sends them to the File Manager . The Wi Fi Recorder activates the 802.11 Radio to scan every tenth of a second and associates those 802.11 readings with the GPS readings coming from the GPS radio and sends the resulting data to the File Manager. The File Manager receives scan data from both the GPS Recorder and Wi Fi Recorder and creates storage files on the device. This process continues the entire time the device is operational and both radios are functioning

In the Upload Manager there is a Hotspot Detector that monitors the 802.11 scanning results to look for the configured network of public hotspots e.g. T mobile that the device is authorized to access. Once it detects a valid Hotspot it notifies the user of its presence. The user can select to connect to the hotspot by activating the Create Connection component . This component associates with the hotspot s access point and creates an 802.11 connection. Then the Hotspot Authentication module supplies valid authentication information for the device. The hotspot validates the account and then provides network access to the device. The Upload Manager then initiates the Upload Server Authentication process to connect to the Central Network Server and provides valid authentication information. Once authenticated the Upload Data Verification module is initiated. This module retrieves the scan data from the Scanning Data store and uploads the data to the Central Network Server using FTP. The Central Network Server initiates a process to store all the data in the Central Access Point Database. After the upload is complete the upload process moves the scan data from the Scanning Data store to the Backup Data store on the device. Once the upload is completed and verified the New Version module checks the Central Network Server to determine if there is a new version of the client software available for the device. If there is a new version the software is downloaded and the New Version Installation process begins to upgrade the client software. Once the installation process is completed the connection with the Central Network Server is terminated the connection with the hotspot is terminated and the device returns to normal scanning operation.

Included in the Scanning Client are a set of utilities that help to manage the device and reduce system errors. The Radio Manager monitors the operation of the GPS Radio and the Wi Fi Radio to make sure they are functioning properly. If the Radio Manager encounters a problem with one of the radios it will restart the radio. The User Interface Controller presents the tools and updates to the user so they can operate the device effectively. The Error Handling and Logging records all system issues to the device and alerts the user so they can address. The System Restart module is called when issues cannot be resolved. This module shuts down the device and restarts the hardware operating system and scanning client to ensure proper operation.

The III 0 of a second 802.11 scanning interval was chosen since it provides the optimal scanning period for 802.11 under these conditions using off the shelf hardware. 802.11b g n operates using 14 channels of the unlicensed spectrum. An individual access point broadcasts its signal beacon over one of those channels at any given time. The scanning device needs to survey each channel in order to observe as many access points as possible. The scanning interval is correlated with the average speed of the scanning vehicle to optimize how the scanning client covers the frequency real estate of a particular region.

With reference to the fleet of vehicles perform their scanning routines while driving their pre designed routes. Periodically each vehicle will connect to an available 802.11 access point and authenticate with the Data Communications Module of the Central Network Server. Typically the access points used for communicating with the Central Network Server are public hotspots like those operated by T Mobile ensuring reliable and metered access. The provisioning of this connection could be done via any available public access point. The scanning vehicle stops at a nearby hotspot location and begins the process of connecting to the access point. Once authenticated the scanning client identifies all the recently collected scan data from the local storage and uploads that data to the Central Network Database .

Once the data has been uploaded to the database the Parser and Filter process begins. The Parser and Filter process reads all of the upload scanning data and loads it up into the appropriate tables of the database. During this exercise the data is evaluated for quality issues. In some cases the GPS receiver may record erroneous or error records for some period of time which could negatively affect the final access point location calculation. The parser and filter process identifies these bad records and either corrects them or removes them from the system. The filtering process users clustering techniques to weed out error prone GPS readings. For example if 90 of the readings are within 200 meters of each other but the remaining 10 of the readings are 5 kilometers away then those outliers are removed by the filter and stored in a corrupted table of the database for further analysis. In particular the system first calculates the weighted centroid for the access point using all reported data. It then determines the standard deviation based on the distribution of the reported locations. The system uses a definable threshold based on the sigma of this distribution to filter out access points that are in error. Once these error records are marked the centroid is recalculated with the remaining location records to determine the final centroid using the Reverse Triangulation method described below.

Note that the error records may be the result of an access point that has moved. In this instance the centroid for the access points will quickly snap to the new location based on the preponderance of records. An additional enhancement to the algorithm would include a weighting value based on the age of the records such that new records represent a more significant indication of the present location for a given access point.

Once the parsing process has been completed the central network system initiates the Reverse Triangulation model begins processing the new data. During this process 1 new access points are added to the database and their physical location is calculated and 2 existing access points are repositioned based on any new data recorded by the scanners. The reverse triangulation algorithm factors in the number of records and their associated signal strengths to weight stronger signal readings more than weaker signals with a quasi weighted average model.

During data gathering a WPS user is equipped with a Wi Fi receiver device which measures Received Signal Strength RSS from all the available Wi Fi access points and then extracts location information of corresponding access points. RSS value of access points are shown as follows RSSI RSS . . . RSSn

If the corresponding recorded GPS location of access point i is denoted by La Long and the calculated access point location is denoted by Lat Long the triangulated position is found by applying the algorithm as follows 

The quad root of power is selected to ease the implementation of the algorithm since quad root is synonymous to taking two square roots.

The second point is referring to adjusting the dynamic range of coefficients. If the dynamic range of coefficients is a concern the coefficient of the algorithm can be divided by a constant number e.g. 

The Parameter C can be any number and it does not impact the results theoretically. Since the weighted average is based on the ratio of the coefficients and not the absolute value theoretically dividing all the coefficients by a constant value C does not impact the results but it changes the dynamic range of the coefficient values.

This final Lat. Long. is then used as the final centroid value for the location of that access point. The latitude and longitude will then be stored in the database including a timestamp to indicate the freshness of the triangulation calculation.

After the Central Network Database has been updated and each access point has been repositioned the Data Pack Builder creates subsets of the database based on regions of the country or world. The pack builder facilitates distribution of the database for a variety of use cases in which only region certain geographies are of interest. The pack builder is configured with region coordinates representing countries time zones and metropolitan areas. Utilizing this technique a user can download just the location data for the west coast of the United States. The pack builder segments the data records and then compresses them.

The Fleet Management Module helps operations personnel manage the scanning vehicles and ensure they are adhering the routing procedures. This module processes all the scan data and builds the location track for each vehicle in the system. The operations manager can create maps of the vehicle track using the Map Builder to visually inspect the coverage for a particular region. The GPS tracking data from each device is reviewed with route mapping software to verify completion of coverage and to identify missed areas. This ability to audit and verify uniform coverage ensures that the system is getting the best data possible. The module also calculates the driving time of the vehicle to determine average speed and to subtract any idle time. These outputs are used to monitor efficiency of the overall system and in planning of future coverage.

It will be appreciated that the scope of the present invention is not limited to the above described embodiments but rather is defined by the appended claims and that these claims will encompass modifications of and improvements to what has been described.

