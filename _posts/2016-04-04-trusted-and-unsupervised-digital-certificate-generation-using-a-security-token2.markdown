---

title: Trusted and unsupervised digital certificate generation using a security token
abstract: A method, system and computer program product for ensuring PKI key pairs are operatively installed within a secure domain of a security token prior to generating a digital certificate. The public key component of the PKI key pair is incorporated into a digital certificate which is returned to the security token for storage. The arrangement included herein incorporates the use of a critical security parameter to ensure a chain of trust with an issuing entity such as a registration authority. Furthermore, the arrangement does not require security officer or system administrator oversight during digital certificate generation as the critical security parameter provides a sufficient level of trust to ensure that digital certificate generation is being performed in conjunction with a designated security token rather than a rogue application. Lastly, separate inventive embodiments allow alternate communications and verification arrangements to be implemented.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09602497&OS=09602497&RS=09602497
owner: Assa Abloy AB
number: 09602497
owner_city: Stockholm
owner_country: SE
publication_date: 20160404
---
This application is a continuation of U.S. application Ser. No. 10 740 889 filed Dec. 22 2003 pending which is hereby incorporated by reference.

The present invention relates generally to a data processing method system and computer program product and more specifically to a method system and computer program product for generating a trusted digital certification using a security token without requiring security officer supervision.

In the relevant art digital certificate generation in enterprise and government operating environments may require an entity to be supervised by a security officer to firstly verify the identity of the entity and secondly to provide a trusted computer system for generation and registration of public key infrastructure PKI keys within the secure domain of the security token. The trusted computer system is provided to ensure that any PKI keys are actually generated by the security token rather than by another source. This process physically requires the user to present credentials such as a driver s license or passport to the security officer who then oversees the PKI key generation process. This supervised mechanism while relatively secure is expensive to maintain and is inconvenient to an individual who may simply want to replace an expired digital certificate or has already been verified.

Alternative certificate generation mechanisms are known in the relevant art but generally do not provide the critical assurance that the key pair is actually installed inside the security token rather than a rogue application impersonating the security token. For example a virtual token emulator virus could cause a PKI key pair to be generated externally on a host computer system in which the public key from the illicit PKI key pair generation becomes incorporated into a digital certificate registered and stored inside the security token.

In most cases security token are designed to prevent unauthorized injection of private keys. However the user having unintentionally stored a bogus digital certificate will lack the ability to utilize security token services and will likely have to go through the process of invalidating the bogus digital certificate which may have already become widely distributed. Furthermore if the virtual token emulator virus were to become widespread the resulting damage and loss of productivity could potentially be as disruptive to an enterprise or other organization as if legitimate private keys were compromised.

A number of mechanisms are available in the relevant art which attempt to address illicit certificate generation. For example in a traditional mechanism U.S. Pat. No. 5 721 781 to Deo et al. provides an authentication system in which a security token is assigned its own digital certificate. The digital certificate contains a digital signature from a trusted certifying authority and a unique public key. In another example US patent application US 2002 0026578 to Hamann et al. provides a mechanism for secure usage of digital certificates and related PKI keys on a security token. The arrangement provided by Hamann et al. allows secure importation of digital certificates into the security token. However neither the latter nor the former mechanisms provide proof that the PKI keys are installed inside the security token.

In another mechanism WIPO application WO0079724A2 to Immonen provides a manufacturer s digital certificate. The digital certificate is stored inside the security token which permits a Certification Authority to verify the creation and storage of a PKI key pair within the secure domain of the security token. Lastly US patent application US2003 0005317 Ser. No. 09 892 904 to Audebert et al. provides an alternate mechanism for generating and verifying a key protection certificate. US patent application US 2003 0005317 is to a common assignee which is herein incorporated by reference and not admitted as prior art. Both of these mechanisms provide added assurances that the PKI key pair is actually installed inside the secure domain of a secure token.

Therefore a trusted security token PKI key pair generation and verification arrangement which prevents unauthorized digital certificate generation and does not require security officer oversight is a highly desirable security feature.

This invention addresses the limitations described above and provides a trusted mechanism for generating a digital certificate using a security token without requiring a security officer or system administrator to verify the user or entity s identity or oversee the certificate generation process. The invention further provides assurances that the generated digital certificate actually incorporates a public key obtained from the secure domain of the security token.

It will be appreciated by one skilled in the art that the trusted digital certificate generation process is not limited to anthropologic implementations. The digital certificate may be associated with either animate or inanimate objects such as an end user an animal having an embedded security token for identification purposes or an intelligent device requiring a digital certificate including but not limited to computer systems cellular telephones personal data assistants key card readers and electronic locks. These various associations are referred to herein as entities.

The term security token as described herein includes hardware based security devices such as cryptographic modules smart cards integrated circuit chip cards portable data carriers PDC personal security devices security token subscriber identification modules SIM wireless identification modules WIM USB token dongles identification tokens secure application modules SAM hardware security modules HSM secure multi media token SMMC trusted platform computing alliance chips TPCA and like devices.

The term critical security parameter CSP as defined herein includes authentication data passwords PINs secrets symmetric and private cryptographic keys which are to be entered into or output from a cryptographic module using a secure mechanism. The definition included herein is intended to be synonymous with the definition of CSP included in FIPS PUB 140 2 Security Requirements for Cryptographic Modules. References included herein to a proof of token key or key set should be considered under the broader CSP definition rather than a specific symmetric or asymmetric key.

In one embodiment of the invention a method is described for issuing a trustworthy digital certificate without a security officer intermediary. The certificate issuance methodology is initiated when an entity inserts or otherwise operatively couples a security token to a computer system and invokes a certificate issuance renewal application installed or otherwise accessible using the computer system.

The certificate issuance renewal application generates an entity specific digital certificate request which is sent to a registration authority. The entity specific digital certificate request includes at least an entity identifier such as unique entity name or a unique security token identifier which is masked into the security token s non volatile memory during the token s manufacturing process.

Upon receiving the entity specific digital certificate request the registration authority performs a security transaction with the security token and sends a PKI key pair generation command to the security token. The security transaction incorporates the use of a pre established proof of token key set securely installed in the security token before issuance to the end entity which is retrieved from a secure storage location based on information included in the entity specific digital certificate request.

Depending on the particular embodiment of the invention the security transaction may occur before or after a PKI key pair generation command is sent from the registration authority to the security token.

The security token receives the PKI key pair generation command generates a public key infrastructure PKI key pair and returns a public key component of the generated PKI key pair to the registration authority. In a first embodiment of the invention a proof in form of a keyed hash message authentication code HMAC operation is generated from the generated public key using the proof of token key and sent along with the public key to the registration authority. In a second embodiment of the invention the public key is signed using the generated private key. The digital signature and public key are then sent to the registration authority in encrypted form for authenticity confirmation.

In a first embodiment the proof of token key is used in generating the keyed HMAC of the public key which provides assurances to the registration authority that the PKI key pair was actually generated within the secure domain of the security token rather than elsewhere. In a second embodiment of the invention the proof of token keys is used for encryption and decryption of information exchanged between the registration authority and the security token. The registration authority retrieves the counterpart proof of token key from a database datastore or a hardware security device using the unique entity and or security token identifier as a cross reference.

In a first embodiment the registration authority generates another HMAC of the received public key using the counterpart proof of token key compares the generated HMAC to the HMAC received from the security token. A match indicates that the public key was actually generated by the security token while a mismatch indicates either the public key was not generated by the security token or an incorrect entity security token identifier was provided. In the case of a failed security transaction processing ends and the entity must repeat the transaction. In a second embodiment of the invention a digital signature is received by the registration authority decrypted using the public key received from the security token and authenticity confirmed.

In a third embodiment of the invention the proof of token key set is incorporated into a secure messaging arrangement after successfully completing a challenge response security transaction controlled by the registration authority. The secure messaging arrangement provides a secure end to end communications channel between the security token and the registration authority using a symmetric encryption mechanism.

In all embodiments of the invention following successful confirmation of the proof the registration authority sends the public key and one or more entity specific datum to a certificate authority. The certificate authority generates an entity specific digital certificate which is then sent either directly or indirectly to the computer system for storage inside the security token. The certificate authority may be a separate third party entity such as Verisign or an internal entity such as an enterprise certificate generation server or an integrated registration and certificate generation server.

From a system perspective the invention is comprised of a security token functionally coupled to a computer system and in processing communications with at least a registration authority via the computer system. The security token is adapted to at least operatively store a PKI key pair and perform at least one security transaction which incorporates at least a pre established critical security parameter. The least one security transaction comprises a challenge response protocol a keyed hashed message authentication code a digital signature or a combination thereof.

In this systematic embodiment of the invention the computer system is adapted to at least receive input from an entity initiate a digital certification generation process between the security token and the at least a registration authority and exchange communications between the security token and the least at least a registration authority. Lastly in this systematic embodiment of the invention the registration authority is adapted to at least cause the PKI key pair to be stored in the security token cause the security token to perform the at least one security transaction and confirm that the pre established critical security parameter is operatively stored within the security token.

In a further systematic embodiment of the invention the security token is further adapted to send a public key associated with the PKI key pair to at least the registration authority and operatively store a digital certificate which incorporates said public key. In this further systematic embodiment of the invention the registration authority is further adapted to cause the digital certificate to be generated and to cause the digital certificate to be operatively stored by the security token.

From a second systematic perspective a second embodiment of the invention comprises a security token including a token processor a token memory coupled to the token processor a pre established critical security parameter operatively stored in at least a portion of the token memory and one or more token applications operatively stored in a second portion of the token memory having instructions executable by the token processor to at least operatively store a PKI key pair in a third portion of the token memory and perform at least one security transaction which incorporates at least the pre established critical security parameter.

In this second systematic embodiment of the invention the local computer system comprises a computer processor a computer memory coupled to the computer s processor a token interface coupled to the computer processor and operative to functionally couple the security token to the computer system a computer communications interface coupled to the computer processor and operative to facilitate communications with at least a registration authority and one or more computer applications operatively stored in a portion of the computer memory having instructions executable by the computer processor to at least initiate a digital certification generation process between the security token and the registration authority and exchange communications between the security token and at least a registration authority.

In this second systematic embodiment of the invention the registration authority comprises an authority processor a authority memory coupled to the authority processor a data store coupled to the authority processor where the data store includes at least one critical security parameter associated with the pre established critical security parameter an authority communications interface coupled to the authority processor and operative to facilitate communications with at least the computer system and one or more authority applications operatively stored in a portion of the authority memory.

The one or more authority applications having instructions executable by the authority processor to at least cause the PKI key pair to be stored in the token memory cause the security token to perform the at least one security transaction and confirm that the pre established critical security parameter is operatively stored within the security token where the at least one security transaction comprises a challenge response protocol a keyed hashed message authentication code a digital signature or a combination thereof.

In a further systematic embodiment of the invention the one or more token applications includes instructions executable by the token processor to send a public key associated with the PKI key pair to at least the registration authority and operatively store a digital certificate which incorporates the public key. In this further systematic embodiment of the invention the one or more authority applications further includes instructions executable by the authority processor to cause the digital certificate to be generated and cause the digital certificate to be operatively stored by the security token.

In both systematic embodiments of the invention the entity specific digital certificate is generated by either the certificate authority or a unified registration authority and incorporates the generated public key and at least a portion of the entity specific information.

In all embodiments of the invention the communications connections between the computer system registration authority and the certificate authority should utilize standard security protocols such as secure socket layer SSL transport layer security TLS private communications technology PCT internet protocol security IPsec or another secure messaging arrangement.

In a first computer program product embodiment of the invention the invention comprises a computer program embodied in a tangible form readable by a first processing system having executable instructions stored thereon for causing said first processing system to perform at least one security transaction with a security token which at least confirms that a pre established critical security parameter is operatively stored within said security token cause a PKI key pair to be operatively stored in said security token and cause said security token to responsively return a public key associated with said PKI key pair from said security token.

In a further embodiment of the first computer program product the executable instructions for causing the first processing system are broaded to cause an entity specific digital certificate which incorporates said public key to be generated and cause said entity specific digital certificate to be stored in at least said security token.

The computer program product according may be stored in tangible form includes magnetic media optical media or logical media such as a CD ROM floppy disk data tape DVD flash RAM or removable hard disk for installation in a code format comprising byte code compiled interpreted compliable or interpretable.

In a second embodiment of the computer program product the invention is embodied in a tangible form readable by a processor to perform at least the major steps described in the method portion of the invention.

This present invention provides an arrangement which facilitates the generation of a trustworthy digital certificate using a security token without requiring a security officer intermediary to verify a user or entity. The applications are envisioned to be programmed in a high level language such as Java C C C or Visual Basic .

Referring to a functional block diagram of the security token enabled computer system is shown which includes a central processor a main memory a display electrically coupled to a display interface a secondary memory subsystem electrically coupled to a hard disk drive a removable storage drive electrically coupled to a removable storage unit and an auxiliary removable storage interface electrically coupled to an auxiliary removable storage unit . A communications interface subsystem is coupled to a network via a network interface . The network includes standard wired optical or wireless networks which incorporates a secure communications protocol comprising secure socket layer SSL transport layer security TLS private communications technology PCT interne protocol security IPsec or other secure messaging arrangement.

A security token ST is operably coupled to the communications interface via a security token interface . The security token includes a unique identifier not shown masked into non volatile memory during the manufacturing process. Entity input devices such as a mouse and a keyboard are operatively coupled to the communications interface via an entity interface . Lastly an optional biometric scanner is operatively coupled to the communications interface via a biometric scanner interface .

The central processor main memory display interface secondary memory subsystem and communications interface system are electrically coupled to a communications infrastructure . The security token enabled computer system CS includes an operating system having a certificate issuance renewal application a security token application programming interface such as PC SC promulgated by the PC SC workgroup specifications available from the organization s website www.pcscworkgroup.com one or more security token aware applications cryptography software capable of performing symmetric and asymmetric cryptographic functions secure messaging software and all necessary device interface and driver software.

The security token ST includes an wireless optical and or electrical connection means compatible with the security token interface a microprocessor a cryptography co processor volatile and non volatile memory electrically coupled to the processor and co processor a runtime operating environment cryptography extensions available to the runtime environment and capable of performing symmetric and asymmetric cryptographic functions compatible with the security token enabled computer system s cryptography software a security executive application critical security parameter described herein as a proof of token key and one or more critical security parameter CSP protected applications.

The proof of token key may be installed by the mechanism described in co pending U.S. application Ser. No. 09 985 343 entitled A System and Method for Generating Symmetric Keys within a Personal Security Device having Minimal Trust Relationships to a common assignee which is herein incorporated by reference. The proof of token key may be installed inside the security token either pre issuance or post issuance so long as a verifiable chain of trust has been maintained with the security token ST .

Referring to a basic embodiment of the invention is shown where a computer system CS is functionally coupled to a security token ST and in processing communications with a registration authority RA . The registration authority RA is in processing communications with a certificate authority CA . The certificate authority CA may be a separate third party entity such as Verisign or an internal entity such as a separate certificate generation server or a server integrated with the registration authority RA .

The security token ST includes a pre established proof of token key set Kpt ID Kpt ID . One pre existing proof of token key Kpt ID is injected into the security token ST prior to issuance to the end entity or user and the counterpart proof of token key Kpt ID is saved in a secure database or in a hardware security module .

In a one embodiment of invention the proof of token key set Kpt ID Kpt ID symmetric keys having a bit strength of at least 64 bits but preferably 128 bits or greater. The proof of token key Kpt D is injected into the security token ST with attributes set to non exportable and may only be accessed by the registration authority or an equivalent administrative entity typically the token issuer. The registration authority RA includes a database or datastore DB having stored thereon one or more proof of token keys Kpt ID retrievable using a unique identifier associated with a particular security token as a cross reference. Alternately the one or more proof of token keys Kpt ID may be retrievably stored inside a hardware security module HSM .

Referring to an initiating process for generating an unsupervised digital certificate is depicted. An entity initiates the process at the computer system CS by invoking a certificate issuance renewal application associated with the computer system CS . The certificate issuance renewal application receives a unique identifier such as an entity ID and or security token ID which becomes incorporated into a certificate request CR ID . The certificate request CR ID is sent to the registration authority RA . The registration authority RA uses the unique identifier to retrieve the proof of token key associated with the unique identifier and security token ST . The proof of token key will be used in a security transaction with a security token . In an alternate embodiment of the invention the initiating process is performed automatically by checking an expiration status associated with existing information stored inside the security token ST such as the expiration status of an existing digital certificate.

Referring to a first embodiment invention is shown where receipt of the certificate request CR ID causes the registration authority RA to send an install PKI key pair and generate proof commands to the security token via the computer system . The security token ST executes the commands and installs the PKI key pair . The install PKI key pair command is generalized in this example to include internal generation of the PKI key pair or external generation and injection into a secure domain of the security token ST . The PKI key pair includes Diffie Hellman Digital Signature DSA elliptical curve and RSA asymmetric key pairs. The specific asymmetric algorithm may be customized to suit a particular security and or performance goal.

For example Diffie Hellman and DSA key pairs are generally only used for signing while RSA and elliptical curve key pairs may be used for both signing and encrypting. However algorithms using RSA key pairs take longer to execute than those using Diffie Hellman which makes optimization desirable for use inside a security token.

In this embodiment of the invention the communications connection between the computer system CS and the registration authority RA preferably includes a secure communications protocol such as SSL TLS IPsec PCT or other secure messaging arrangement.

The generate proof command is generalized to include standard challenge response mechanisms which incorporate the proof of token key Kpt ID hashed message authentication codes HMAC which incorporate the proof of token key Kpt ID or digital signature which incorporates the generated private key Kpri ID . However one skilled in the art will appreciate that combinations of the proof mechanisms may be employed as well.

Referring to FIG. B an alternate embodiment of the invention is shown where the install PKI key pair and generate proof commands are encrypted with the proof of token key Kpt ID retrieved from the datastore . In this embodiment of the invention the incoming commands need to be decrypted using the token s proof of token Kpt ID before any processing is performed by the security token and is particularly suited for use in the digital signature embodiment of the invention described in the discussion provided for FIG. C.

Referring to after executing the commands the security token ST returns the public key portion of the PKI key pair and a proof of the public key to the registration authority RA . In this embodiment of the invention the proof is a keyed message authentication code HMAC. The proof of token key or a derivative thereof is used in the generation of the keyed message authentication code HMAC . The registration authority RA retrieves the proof of token key Kpt ID from the datastore and generates another Proof using the retrieved proof of token key Kpt ID and the same algorithm for comparison with the proof received from the security token ST . If the two proofs match the entity specific digital certificate request CR ID and the public key are sent to the certificate authority CA for generation of an entity specific digital certificate.

Referring to FIG. C an another embodiment of the invention is shown where the proof is a digital signature of the public key Kpub ID using the counterpart private key Kpri ID . In this embodiment of the invention the public key Kpub ID and the proof are encrypted with the token s proof of token key Kpt ID and sent to the registration authority for confirmation. The registration authority decrypts the received public key Kpub ID and the proof with the proof of token key Kpt ID retrieved from the datastore and then verifies the digital signature using the received public key Kpub ID . If the two proofs match the entity specific digital certificate request CR ID and the public key are sent to the certificate authority CA for generation of an entity specific digital certificate as described above.

Referring to the certificate authority CA receives the entity specific digital certificate request CR ID and the public key and generates an entity specific digital certificate which incorporates the public key and at least a portion of entity specific digital certificate request CR ID . The digital certificate is returned to the registration authority RA where it is subsequently stored inside the security token ST . Alternately the digital certificate may be returned directly to the computer system CS and stored inside the security token .

Referring to another alternate authentication embodiment of the invention is shown which continues following receipt of the certificate request CR ID shown in above. The registration authority RA performs a challenge response security transaction with the security token ST using the retrieved proof of token key Kpt ID or a derivative thereof. The proof of token key set Kpt ID Kpt ID will be incorporated into a secure messaging session which provides a secure communications channel between the security token ST and the registration authority RA .

Referring to once the security token ST has been successfully authenticated to the registration authority RA a symmetric secure messaging arrangement is established between the security token ST and the registration authority RA . This secure messaging arrangement is described in co pending U.S. patent application Ser. No. 10 424 783 entitled Universal Secure Messaging For Cryptographic Modules filed on Apr. 29 2003 and assigned to a common assignee and is herein incorporated by reference.

Referring to the major steps involved in a first embodiment of the invention for generating an unsupervised digital certificate is shown. The process is initiated by sending an entity specific digital certificate request to a registration authority . In this first embodiment invention the registration authority sends a PKI key pair install command to the security token . The install command is generalized to include both internal and external generation of the PKI key pair and a proof command. The security token installs the PKI key pair and a proof which incorporates a proof of token key . Depending on the type of proof requested by the proof command the PKI key pair and a proof commands may be encrypted using the registration authority s proof of token key.

In the encrypted command version of the invention the incoming commands are decrypted using the token s proof of token key. The type of proof may be a hashed message authentication code generated from the recently installed public key component of the PKI key pair and the proof of token key or a digital signature of the public key generated by signing the public key with its counterpart private key or an encrypted random number as part of a challenge response security transaction or other encrypted data confirmable by the registration authority such as the token s unique identifier. In the digital signature embodiment of the invention the public key and digital signature are encrypted using the proof of token key and sent to the registration authority for confirmation of the proof. In the HMAC embodiment of the invention the PKI key pair and the proof are returned to the registration authority .

The registration authority confirms the proof using a counterpart proof of token key retrieved from a datastore. If the proof is not confirmed processing ends and the entity must restart the process. If the proof is confirmed the registration authority sends the public key and the entity specific digital certificate request to a certificate authority . The certificate authority generates an entity specific digital certificate which incorporates the public key and at least a portion of the entity specific digital certificate request . The digital certificate is then sent to the security token and stored inside the security token . The generated entity specific digital certificate may be sent directly to the computer system hosting the security token or sent via the registration authority. Normal processing terminates following storage of the digital certificate .

Lastly referring to the major steps involved in generating a unsupervised digital certificate using a second embodiment of the invention is shown. In this embodiment of the invention it is not necessary to send a proof together with the public key as successful establishment of the secure communications arrangement provides an implicit proof to the registration authority. The process is initiated by sending an entity specific digital certificate request to the registration authority as before followed by performing a security transaction in a process which incorporates the proof of token key set . If the security transaction is not successful processing ends and the entity must again restart the process.

If the security transaction is successful a secure end to end communications channel is established between the security token and registration authority . The secure communications channel incorporates the proof of token key set into a symmetric cryptography session.

Once the secure communications channel has been established the registration authority sends a PKI key pair install command to the security token which causes the security token to generate a PKI key pair . The public key component of the PKI key pair is then returned to the registration authority . The registration authority then sends the public key and the entity specific digital certificate request to the certificate authority for generation of a digital certificate which incorporates the public key component of the PKI key pair and at least a portion of the entity specific digital certificate request . The digital certificate is then sent as before to the security token . Normal processing terminates following storage of the digital certificate .

The foregoing described embodiments of the invention are provided as illustrations and descriptions. They are not intended to limit the invention to precise form described. In particular it is contemplated that functional implementation of the invention described herein may be implemented equivalently in hardware software firmware and or other available functional components or building blocks. No specific limitation is intended to a particular cryptographic module operating environment. Other variations and embodiments are possible in light of above teachings and it is not intended that this Detailed Description limit the scope of invention but rather by the Claims following herein.

