---

title: Day and night detection based on one or more of illuminant detection, lux level detection, and tiling
abstract: A method for controlling a camera mode is executed at a camera including a controller, a sensor array, an IR filter, and a lens assembly. The camera is operated in a night mode. While in the night mode the IR filter is not interposed between the lens assembly and the sensor array, the camera receives at the sensor array ambient light that is not filtered by the IR filter, determines whether the received ambient light is due to a light source other than an IR light source, and detects a light level of the received ambient light. The camera switches the operation of the camera from the night mode to a day mode when it is determined the received ambient light is due to a light source other than an IR light source and that the light level of the received ambient light exceeds a first threshold.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09549124&OS=09549124&RS=09549124
owner: GOOGLE INC.
number: 09549124
owner_city: Mountain View
owner_country: US
publication_date: 20160518
---
This application is a continuation of U.S. patent application Ser. No. 14 738 225 filed Jun. 12 2015 entitled Day and Night Detection Based on One or More of Illuminant Detection Lux Level Detection and Tiling which is hereby incorporated by reference in its entirety.

This application is related to the following application which is hereby incorporated by reference in its entirety U.S. patent application Ser. No. 14 723 276 filed on May 27 2015 entitled Multi mode LED Illumination System. 

The disclosed implementations relate generally to controlling a camera with day and night modes including but not limited deciding when to change a camera from night to day mode.

Some security cameras operate in one of two modes depending on the ambient lighting conditions. Day mode is used when there is sufficient ambient light to adequately illuminate the scene. Night mode or IR mode is used when there is not enough ambient light to adequately illuminate the scene in which case the camera can provide its own IR illumination e.g. using onboard IR LEDs .

One challenge for such cameras is deciding when to switch from Night mode to Day mode. Typically Night mode is maintained until the camera detects an external light source that provides enough light for Day mode operation. This is a challenge in Night mode as the camera needs to evaluate the amount of visible ambient light from external light sources but many light sources provide a combination of both IR and visible light and in Night mode the camera sensor is responsive to both IR and visible light.

As a result in a situation where a light source provides a high proportion of IR light in comparison to visible light a camera in Night mode can switch into Day mode even though there is not enough visible ambient light to illuminate the scene. This can result in oscillations between Day mode and Night mode e.g. after switching from Night to Day mode the camera will determines that there is not enough visible light for Day mode operation so will switch back to Night mode and so on .

Traditional mode switching methods are also commonly fooled into switching from Night mode to Day mode in response to bright but narrow beam light sources such as flashlights or car headlights that only provide light for a small portion of a scene. When exposed to such lights a camera will often switch to Day mode which results in captured images being almost entirely dark due to lack of adequate ambient light.

Accordingly there is a need for a security camera that implements more effective methods for deciding when to switch from Night mode to Day mode.

In accordance with some implementations systems and methods are described herein that provide more effective Night mode to Day mode switching in a camera. The described systems and methods provide one or more advantages in comparison to prior methods 

In particular the systems and methods described herein utilize a combination of illuminant detection lux level detection and tiling to determine when to switch from Night mode to Day mode without the attendant problems observed in prior art approaches to mode switching.

In some implementations a method for Night to Day mode switching is performed at a camera including a controller memory storing instructions for execution by the controller a color sensor array comprising a plurality of sensor locations the sensor locations including first second and third pixels each having respective peak responses at different respective visible light frequencies and a lens assembly that is configured to focus light on the sensor array. The method includes when the camera mode is a night mode and the sensor is exposed to ambient light via the lens assembly detecting a first light component of the ambient light by averaging output signals from the first pixels detecting a second light component of the ambient light by averaging output signals from the second pixels detecting a third light component of the ambient light by averaging output signals from the third pixels determining based on respective values of the first second and third light components whether the ambient light is due to other an IR light source detecting the ambient light level based on a determination that the ambient light is due to other than an IR light source and the ambient light level exceeds a first lux threshold initiating a change of the camera mode to a day mode based on a determination that the ambient light is due to other than an IR light source and the ambient light threshold does not exceed the first lux threshold maintaining the camera in the night mode.

In some implementations the method further includes determining based on values of the first second and third light components whether the ambient light is due to sunlight or an incandescent light source and based on a determination that the ambient light is due to sunlight or an incandescent light source initiating a change of the camera mode to the day mode only when the ambient light level exceeds a second lux threshold higher than the first lux threshold.

In some implementations the method further includes obtaining a first ratio of the first to the second lighting components of the ambient light obtaining a second ratio of the third to the second lighting components of the ambient light and obtaining a graph characterizing respective types of light source based on a combination of the first and second ratios associated with the respective types of light sources wherein determining whether the ambient light is due to other than an IR light source includes determining based on the graph whether a light source characterized by the first ratio and the second ratio is other than an IR light source.

In some implementations the graph recited above identifies a first region defined by specific respective ranges of the first and the second ratios as being associated with sunlight or incandescent light sources wherein determining whether the ambient light is due to sunlight or an incandescent light source includes determining based on the graph whether a point defined by the first ratio and the second ratio lies within the first region.

In some implementations determining whether the ambient light is due to other than an IR light source includes determining that a point defined by the first ratio and the second ratio is substantially different from 1 1 .

In some implementations the camera includes a gain controller that adjusts analog gain of the sensor array based on the ambient light level such that detecting the ambient light level includes obtaining the analog gain of the sensor array.

In some implementations the analog gain of the sensor varies with a frame rate of the camera the method further including determining a first frame rate of the camera used to detect the first second and third light components and normalizing the obtained analog gain of the sensor based on a first difference between the first frame rate and a predefined frame rate and predefined associated differences in analog sensor gain based on the first difference.

In some implementations the camera includes an IR filter with a first position in which it is interposed between the lens and the sensor array and a second position in which it is not interposed between the lens and sensor array the method further including as part of initiating a change of the camera mode to the day mode switching the camera mode to the day mode and causing the IR filter to be moved from the second position to the first position.

In some implementations the camera includes an auto white balance processor that provides the obtained first and second ratios.

In some implementations the color sensor array is one tile of a plurality of tiles in a color sensor array system and the method of claim is performed for each of the tiles such that a respective mode change signal is generated for a respective tile for which the ambient light at that respective tile is due to other than an IR light source prior to initiating the change of the camera mode to the day mode the method further comprising determining a total number of the mode change signals for the color sensor array system determining whether the total number of the mode change signals exceeds a predetermined mode change threshold based on a total number of tiles in the color sensor array system and when the total number of the mode change signals exceeds the mode change threshold initiating the change of the camera mode to the day mode.

In some implementations the graph recited herein is represented using two look up tables each addressable by a first index representing one of the first ratios and a second index representing one of the second ratios wherein a first one of the lookup tables defines combinations of the first and second ratios associated respectively with IR light sources and other than IR light sources and a second one of the lookup tables defines combinations of the first and second ratios associated with sunlight and incandescent lights.

In some implementations the first lookup table encodes with 1 s first table locations associated with other than IR light sources and with 0 s first table locations associated with IR light sources such that the first lookup table is almost entirely filled with all 1 s apart from table locations associated with pairs of first and second ratios substantially similar to 1.1 .

In some implementations the second lookup table corresponds to a higher resolution version of a sub region of the first lookup table wherein the second lookup table encodes with 1 s second table locations associated with sunlight and incandescent light sources and with 0 s second table locations associated with other than sunlight and incandescent light sources.

In yet another aspect some implementations include a system for controlling a camera mode including a controller memory storing one or more programs for execution by the controller a color sensor array comprising a plurality of sensor locations the sensor locations including first second and third pixels each having respective peak responses at different respective visible light frequencies and a lens assembly that is configured to focus light on the sensor array the one or more programs including instructions for performing any of the methods described herein e.g. any of the methods described above .

In yet another aspect some implementations include a non transitory computer readable storage medium storing one or programs for execution by a camera system that includes a controller memory storing one or more programs for execution by the controller a color sensor array comprising a plurality of sensor locations the sensor locations including first second and third pixels each having respective peak responses at different respective visible light frequencies and a lens assembly that is configured to focus light on the sensor array the one or more programs including instructions for performing any of the methods described herein e.g. any of the methods described above .

Thus a camera and camera program modules are provided that implement more effective methods for deciding when to switch from Night mode to Day mode. Such methods may complement or replace conventional methods for controlling camera modes.

Reference will now be made in detail to implementations examples of which are illustrated in the accompanying drawings. In the following detailed description numerous specific details are set forth in order to provide a thorough understanding of the various described implementations. However it will be apparent to one of ordinary skill in the art that the various described implementations may be practiced without these specific details. In other instances well known methods procedures components circuits and networks have not been described in detail so as not to unnecessarily obscure aspects of the implementations.

It will also be understood that although the terms first second etc. are in some instances used herein to describe various elements these elements should not be limited by these terms. These terms are only used to distinguish one element from another. For example a first user interface could be termed a second user interface and similarly a second user interface could be termed a first user interface without departing from the scope of the various described implementations. The first user interface and the second user interface are both types of user interfaces but they are not the same user interface.

The terminology used in the description of the various described implementations herein is for the purpose of describing particular implementations only and is not intended to be limiting. As used in the description of the various described implementations and the appended claims the singular forms a an and the are intended to include the plural forms as well unless the context clearly indicates otherwise. It will also be understood that the term and or as used herein refers to and encompasses any and all possible combinations of one or more of the associated listed items. It will be further understood that the terms includes including comprises and or comprising when used in this specification specify the presence of stated features integers steps operations elements and or components but do not preclude the presence or addition of one or more other features integers steps operations elements components and or groups thereof.

As used herein the term if is optionally construed to mean when or upon or in response to determining or in response to detecting or in accordance with a determination that depending on the context. Similarly the phrase if it is determined or if a stated condition or event is detected is optionally construed to mean upon determining or in response to determining or upon detecting the stated condition or event or in response to detecting the stated condition or event or in accordance with a determination that a stated condition or event is detected depending on the context.

It is to be appreciated that smart home environments may refer to smart environments for homes such as a single family house but the scope of the present teachings is not so limited. The present teachings are also applicable without limitation to duplexes townhomes multi unit apartment buildings hotels retail stores office buildings industrial buildings and more generally any living space or work space.

It is also to be appreciated that while the terms user customer installer homeowner occupant guest tenant landlord repair person and the like may be used to refer to the person or persons acting in the context of some particularly situations described herein these references do not limit the scope of the present teachings with respect to the person or persons who are performing such actions. Thus for example the terms user customer purchaser installer subscriber and homeowner may often refer to the same person in the case of a single family residential dwelling because the head of the household is often the person who makes the purchasing decision buys the unit and installs and configures the unit and is also one of the users of the unit. However in other scenarios such as a landlord tenant environment the customer may be the landlord with respect to purchasing the unit the installer may be a local apartment supervisor a first user may be the tenant and a second user may again be the landlord with respect to remote control functionality. Importantly while the identity of the person performing the action may be germane to a particular advantage provided by one or more of the implementations such identity should not be construed in the descriptions that follow as necessarily limiting the scope of the present teachings to those particular individuals having those particular identities.

The depicted structure includes a plurality of rooms separated at least partly from each other via walls . The walls may include interior walls or exterior walls. Each room may further include a floor and a ceiling . Devices may be mounted on integrated with and or supported by a wall floor or ceiling .

In some implementations the integrated devices of the smart home environment include intelligent multi sensing network connected devices that integrate seamlessly with each other in a smart home network e.g. and or with a central server or a cloud computing system to provide a variety of useful smart home functions. The smart home environment may include one or more intelligent multi sensing network connected thermostats hereinafter referred to as smart thermostats one or more intelligent network connected multi sensing hazard detection units hereinafter referred to as smart hazard detectors one or more intelligent multi sensing network connected entryway interface devices and hereinafter referred to as smart doorbells and smart door locks and one or more intelligent multi sensing network connected alarm systems hereinafter referred to as smart alarm systems .

In some implementations the one or more smart thermostats detect ambient climate characteristics e.g. temperature and or humidity and control a HVAC system accordingly. For example a respective smart thermostat includes an ambient temperature sensor.

The one or more smart hazard detectors may include thermal radiation sensors directed at respective heat sources e.g. a stove oven other appliances a fireplace etc. . For example a smart hazard detector in a kitchen includes a thermal radiation sensor directed at a stove oven . A thermal radiation sensor may determine the temperature of the respective heat source or a portion thereof at which it is directed and may provide corresponding blackbody radiation data as output.

The smart doorbell and or the smart door lock may detect a person s approach to or departure from a location e.g. an outer door control doorbell door locking functionality e.g. receive user inputs from a portable electronic device to actuate bolt of the smart door lock announce a person s approach or departure via audio or visual means and or control settings on a security system e.g. to activate or deactivate the security system when occupants go and come .

The smart alarm system may detect the presence of an individual within close proximity e.g. using built in IR sensors sound an alarm e.g. through a built in speaker or by sending commands to one or more external speakers and send notifications to entities or users within outside of the smart home network . In some implementations the smart alarm system also includes one or more input devices or sensors e.g. keypad biometric scanner NFC transceiver microphone for verifying the identity of a user and one or more output devices e.g. display speaker . In some implementations the smart alarm system may also be set to an armed mode such that detection of a trigger condition or event causes the alarm to be sounded unless a disarming action is performed.

In some implementations the smart home environment includes one or more intelligent multi sensing network connected wall switches hereinafter referred to as smart wall switches along with one or more intelligent multi sensing network connected wall plug interfaces hereinafter referred to as smart wall plugs . The smart wall switches may detect ambient lighting conditions detect room occupancy states and control a power and or dim state of one or more lights. In some instances smart wall switches may also control a power state or speed of a fan such as a ceiling fan. The smart wall plugs may detect occupancy of a room or enclosure and control supply of power to one or more wall plugs e.g. such that power is not supplied to the plug if nobody is at home .

In some implementations the smart home environment of includes a plurality of intelligent multi sensing network connected appliances hereinafter referred to as smart appliances such as refrigerators stoves ovens televisions washers dryers lights stereos intercom systems garage door openers floor fans ceiling fans wall air conditioners pool heaters irrigation systems security systems space heaters window AC units motorized duct vents and so forth. In some implementations when plugged in an appliance may announce itself to the smart home network such as by indicating what type of appliance it is and it may automatically integrate with the controls of the smart home. Such communication by the appliance to the smart home may be facilitated by either a wired or wireless communication protocol. The smart home may also include a variety of non communicating legacy appliances such as old conventional washer dryers refrigerators and the like which may be controlled by smart wall plugs . The smart home environment may further include a variety of partially communicating legacy appliances such as infrared IR controlled wall air conditioners or other IR controlled devices which may be controlled by IR signals provided by the smart hazard detectors or the smart wall switches .

In some implementations the smart home environment includes one or more network connected cameras that are configured to provide video monitoring and security in the smart home environment . In some implementations cameras also capture video when other conditions or hazards are detected in order to provide visual monitoring of the smart home environment when those conditions or hazards occur. The cameras may be used to determine occupancy of the structure and or particular rooms in the structure and thus may act as occupancy sensors. For example video captured by the cameras may be processed to identify the presence of an occupant in the structure e.g. in a particular room . Specific individuals may be identified based for example on their appearance e.g. height face and or movement e.g. their walk gait . For example cameras may additionally include one or more sensors e.g. IR sensors motion detectors input devices e.g. microphone for capturing audio and output devices e.g. speaker for outputting audio .

The smart home environment may additionally or alternatively include one or more other occupancy sensors e.g. the smart doorbell smart door locks touch screens IR sensors microphones ambient light sensors motion detectors smart nightlights etc. . In some implementations the smart home environment includes radio frequency identification RFID readers e.g. in each room or a portion thereof that determine occupancy based on RFID tags located on or embedded in occupants. For example RFID readers may be integrated into the smart hazard detectors .

The smart home environment may include one or more sound and or vibration sensors for detecting abnormal sounds and or vibrations. These sensors may be integrated with any of the devices described above. The sound sensors detect sound above a decibel threshold. The vibration sensors detect vibration above a threshold directed at a particular area e.g. vibration on a particular window when a force is applied to break the window .

Conditions detected by the devices described above e.g. motion sound vibrations hazards may be referred to collectively as alert events.

The smart home environment may also include communication with devices outside of the physical home but within a proximate geographical range of the home. For example the smart home environment may include a pool heater monitor that communicates a current pool temperature to other devices within the smart home environment and or receives commands for controlling the pool temperature. Similarly the smart home environment may include an irrigation monitor that communicates information regarding irrigation systems within the smart home environment and or receives control information for controlling such irrigation systems.

By virtue of network connectivity one or more of the smart home devices of may further allow a user to interact with the device even if the user is not proximate to the device. For example a user may communicate with a device using a computer e.g. a desktop computer laptop computer or tablet or other portable electronic device e.g. a mobile phone such as a smart phone . A webpage or application may be configured to receive communications from the user and control the device based on the communications and or to present information about the device s operation to the user. For example the user may view a current set point temperature for a device e.g. a stove and adjust it using a computer. The user may be in the structure during this remote communication or outside the structure.

As discussed above users may control smart devices in the smart home environment using a network connected computer or portable electronic device . In some examples some or all of the occupants e.g. individuals who live in the home may register their device with the smart home environment . Such registration may be made at a central server to authenticate the occupant and or the device as being associated with the home and to give permission to the occupant to use the device to control the smart devices in the home. An occupant may use their registered device to remotely control the smart devices of the home such as when the occupant is at work or on vacation. The occupant may also use their registered device to control the smart devices when the occupant is actually located inside the home such as when the occupant is sitting on a couch inside the home. It should be appreciated that instead of or in addition to registering devices the smart home environment may make inferences about which individuals live in the home and are therefore occupants and which devices are associated with those individuals. As such the smart home environment may learn who is an occupant and permit the devices associated with those individuals to control the smart devices of the home.

In some implementations in addition to containing processing and sensing capabilities devices and or collectively referred to as the smart devices are capable of data communications and information sharing with other smart devices a central server or cloud computing system and or other devices that are network connected. Data communications may be carried out using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. and or any of a variety of custom or standard wired protocols e.g. Ethernet HomePlug etc. or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

In some implementations the smart devices serve as wireless or wired repeaters. In some implementations a first one of the smart devices communicates with a second one of the smart devices via a wireless router. The smart devices may further communicate with each other via a connection e.g. network interface to a network such as the Internet . Through the Internet the smart devices may communicate with a smart home provider server system also called a central server system and or a cloud computing system herein . The smart home provider server system may be associated with a manufacturer support entity or service provider associated with the smart device s . In some implementations a user is able to contact customer support using a smart device itself rather than needing to use other communication means such as a telephone or Internet connected computer. In some implementations software updates are automatically sent from the smart home provider server system to smart devices e.g. when available when purchased or at routine intervals .

In some implementations the network interface includes a conventional network device e.g. a router and the smart home environment of includes a hub device that is communicatively coupled to the network s directly or via the network interface . The hub device is further communicatively coupled to one or more of the above intelligent multi sensing network connected devices e.g. smart devices of the smart home environment . Each of these smart devices optionally communicates with the hub device using one or more radio communication networks available at least in the smart home environment e.g. ZigBee Z Wave Insteon Bluetooth Wi Fi and other radio communication networks . In some implementations the hub device and devices coupled with to the hub device can be controlled and or interacted with via an application running on a smart phone household controller laptop tablet computer game console or similar electronic device. In some implementations a user of such controller application can view status of the hub device or coupled smart devices configure the hub device to interoperate with smart devices newly introduced to the home network commission new smart devices and adjust or view settings of connected smart devices etc. In some implementations the hub device extends capabilities of low capability smart device to match capabilities of the highly capable smart devices of the same type integrates functionality of multiple different device types even across different communication protocols and is configured to streamline adding of new devices and commissioning of the hub device.

In some implementations some low power nodes are incapable of bidirectional communication. These low power nodes send messages but they are unable to listen . Thus other devices in the smart home environment such as the spokesman nodes cannot send information to these low power nodes.

In some implementations some low power nodes are capable of only a limited bidirectional communication. For example other devices are able to communicate with the low power nodes only during a certain time period.

As described in some implementations the smart devices serve as low power and spokesman nodes to create a mesh network in the smart home environment . In some implementations individual low power nodes in the smart home environment regularly send out messages regarding what they are sensing and the other low powered nodes in the smart home environment in addition to sending out their own messages forward the messages thereby causing the messages to travel from node to node i.e. device to device throughout the smart home network . In some implementations the spokesman nodes in the smart home network which are able to communicate using a relatively high power communication protocol such as IEEE 802.11 are able to switch to a relatively low power communication protocol such as IEEE 802.15.4 to receive these messages translate the messages to other communication protocols and send the translated messages to other spokesman nodes and or the smart home provider server system using e.g. the relatively high power communication protocol . Thus the low powered nodes using low power communication protocols are able to send and or receive messages across the entire smart home network as well as over the Internet to the smart home provider server system . In some implementations the mesh network enables the smart home provider server system to regularly receive data from most or all of the smart devices in the home make inferences based on the data facilitate state synchronization across devices within and outside of the smart home network and send commands to one or more of the smart devices to perform tasks in the smart home environment.

As described the spokesman nodes and some of the low powered nodes are capable of listening. Accordingly users other devices and or the smart home provider server system may communicate control commands to the low powered nodes. For example a user may use the electronic device e.g. a smart phone to send commands over the Internet to the smart home provider server system which then relays the commands to one or more spokesman nodes in the smart home network . The spokesman nodes may use a low power protocol to communicate the commands to the low power nodes throughout the smart home network as well as to other spokesman nodes that did not receive the commands directly from the smart home provider server system .

In some implementations a smart nightlight which is an example of a smart device is a low power node. In addition to housing a light source the smart nightlight houses an occupancy sensor such as an ultrasonic or passive IR sensor and an ambient light sensor such as a photo resistor or a single pixel sensor that measures light in the room. In some implementations the smart nightlight is configured to activate the light source when its ambient light sensor detects that the room is dark and when its occupancy sensor detects that someone is in the room. In other implementations the smart nightlight is simply configured to activate the light source when its ambient light sensor detects that the room is dark. Further in some implementations the smart nightlight includes a low power wireless communication chip e.g. a ZigBee chip that regularly sends out messages regarding the occupancy of the room and the amount of light in the room including instantaneous messages coincident with the occupancy sensor detecting the presence of a person in the room. As mentioned above these messages may be sent wirelessly e.g. using the mesh network from node to node i.e. smart device to smart device within the smart home network as well as over the Internet to the smart home provider server system .

Other examples of low power nodes include battery operated versions of the smart hazard detectors . These smart hazard detectors are often located in an area without access to constant and reliable power and may include any number and type of sensors such as smoke fire heat sensors e.g. thermal radiation sensors carbon monoxide dioxide sensors occupancy motion sensors ambient light sensors ambient temperature sensors humidity sensors and the like. Furthermore smart hazard detectors may send messages that correspond to each of the respective sensors to the other devices and or the smart home provider server system such as by using the mesh network as described above.

Examples of spokesman nodes include smart doorbells smart thermostats smart wall switches and smart wall plugs . These devices are often located near and connected to a reliable power source and therefore may include more power consuming components such as one or more communication chips capable of bidirectional communication in a variety of protocols.

In some implementations the smart home environment includes service robots that are configured to carry out in an autonomous manner any of a variety of household tasks.

As explained above with reference to in some implementations the smart home environment of includes a hub device that is communicatively coupled to the network s directly or via the network interface . The hub device is further communicatively coupled to one or more of the smart devices using a radio communication network that is available at least in the smart home environment . Communication protocols used by the radio communication network include but are not limited to ZigBee Z Wave Insteon EuOcean Thread OSIAN Bluetooth Low Energy and the like. In some implementations the hub device not only converts the data received from each smart device to meet the data format requirements of the network interface or the network s but also converts information received from the network interface or the network s to meet the data format requirements of the respective communication protocol associated with a targeted smart device. In some implementations in addition to data format conversion the hub device further processes the data received from the smart devices or information received from the network interface or the network s preliminary. For example the hub device can integrate inputs from multiple sensors connected devices including sensors devices of the same and or different types perform higher level processing on those inputs e.g. to assess the overall environment and coordinate operation among the different sensors devices and or provide instructions to the different devices based on the collection of inputs and programmed processing. It is also noted that in some implementations the network interface and the hub device are integrated to one network device. Functionality described herein is representative of particular implementations of smart devices control application s running on representative electronic device s such as a smart phone hub device s and server s coupled to hub device s via the Internet or other Wide Area Network. All or a portion of this functionality and associated operations can be performed by any elements of the described system for example all or a portion of the functionality described herein as being performed by an implementation of the hub device can be performed in different system implementations in whole or in part on the server one or more connected smart devices and or the control application or different combinations thereof.

In some implementations the devices and services platform communicates with and collects data from the smart devices of the smart home environment . In addition in some implementations the devices and services platform communicates with and collects data from a plurality of smart home environments across the world. For example the smart home provider server system collects home data from the devices of one or more smart home environments where the devices may routinely transmit home data or may transmit home data in specific instances e.g. when a device queries the home data . Example collected home data includes without limitation power consumption data blackbody radiation data occupancy data HVAC settings and usage data carbon monoxide levels data carbon dioxide levels data volatile organic compounds levels data sleeping schedule data cooking schedule data inside and outside temperature humidity data television viewership data inside and outside noise level data pressure data video data etc.

In some implementations the smart home provider server system provides one or more services to smart homes and or third parties. Example services include without limitation software updates customer support sensor data collection logging remote access remote or distributed control and or use suggestions e.g. based on collected home data to improve performance reduce utility cost increase safety etc. In some implementations data associated with the services is stored at the smart home provider server system and the smart home provider server system retrieves and transmits the data at appropriate times e.g. at regular intervals upon receiving a request from a user etc. .

In some implementations the extensible devices and services platform includes a processing engine which may be concentrated at a single server or distributed among several different computing entities without limitation. In some implementations the processing engine includes engines configured to receive data from the devices of smart home environments e.g. via the Internet and or a network interface to index the data to analyze the data and or to generate statistics based on the analysis or as part of the analysis. In some implementations the analyzed data is stored as derived home data .

Results of the analysis or statistics may thereafter be transmitted back to the device that provided home data used to derive the results to other devices to a server providing a webpage to a user of the device or to other non smart device entities. In some implementations usage statistics usage statistics relative to use of other devices usage patterns and or statistics summarizing sensor readings are generated by the processing engine and transmitted. The results or statistics may be provided via the Internet . In this manner the processing engine may be configured and programmed to derive a variety of useful information from the home data . A single server may include one or more processing engines.

The derived home data may be used at different granularities for a variety of useful purposes ranging from explicit programmed control of the devices on a per home per neighborhood or per region basis for example demand response programs for electrical utilities to the generation of inferential abstractions that may assist on a per home basis for example an inference may be drawn that the homeowner has left for vacation and so security detection equipment may be put on heightened sensitivity to the generation of statistics and associated inferential abstractions that may be used for government or charitable purposes. For example processing engine may generate statistics about device usage across a population of devices and send the statistics to device users service providers or other entities e.g. entities that have requested the statistics and or entities that have provided monetary compensation for the statistics .

In some implementations to encourage innovation and research and to increase products and services available to users the devices and services platform exposes a range of application programming interfaces APIs to third parties such as charities governmental entities e.g. the Food and Drug Administration or the Environmental Protection Agency academic institutions e.g. university researchers businesses e.g. providing device warranties or service to related equipment targeting advertisements based on home data utility companies and other third parties. The APIs are coupled to and permit third party systems to communicate with the smart home provider server system including the services the processing engine the home data and the derived home data . In some implementations the APIs allow applications executed by the third parties to initiate specific data processing tasks that are executed by the smart home provider server system as well as to receive dynamic updates to the home data and the derived home data .

For example third parties may develop programs and or applications e.g. web applications or mobile applications that integrate with the smart home provider server system to provide services and information to users. Such programs and applications may be for example designed to help users reduce energy consumption to preemptively service faulty equipment to prepare for high service demands to track past service performance etc. and or to perform other beneficial functions or tasks.

In some implementations processing engine includes a challenges rules compliance rewards paradigm that informs a user of challenges competitions rules compliance regulations and or rewards and or that uses operation data to determine whether a challenge has been met a rule or regulation has been complied with and or a reward has been earned. The challenges rules and or regulations may relate to efforts to conserve energy to live safely e.g. reducing the occurrence of heat source alerts e.g. reducing exposure to toxins or carcinogens to conserve money and or equipment life to improve health etc. For example one challenge may involve participants turning down their thermostat by one degree for one week. Those participants that successfully complete the challenge are rewarded such as with coupons virtual currency status etc. Regarding compliance an example involves a rental property owner making a rule that no renters are permitted to access certain owner s rooms. The devices in the room having occupancy sensors may send updates to the owner when the room is accessed.

In some implementations processing engine integrates or otherwise uses extrinsic information from extrinsic sources to improve the functioning of one or more processing paradigms. Extrinsic information may be used to interpret data received from a device to determine a characteristic of the environment near the device e.g. outside a structure that the device is enclosed in to determine services or products available to the user to identify a social network or social network information to determine contact information of entities e.g. public service entities such as an emergency response team the police or a hospital near the device to identify statistical or environmental conditions trends or other information associated with a home or neighborhood and so forth.

In some implementations the smart home provider server system or a component thereof serves as the hub device server system the hub device server system is a part or component of the smart home provider server system . In some implementations the hub device server system is a dedicated video processing server that provides video processing services to video sources and client devices independent of other services provided by the hub device server system . An example of a video processing server is described below with reference to .

In some implementations each of the video sources includes one or more video cameras that capture video and send the captured video to the hub device server system substantially in real time. In some implementations each of the video sources optionally includes a controller device not shown that serves as an intermediary between the one or more cameras and the hub device server system . The controller device receives the video data from the one or more cameras optionally performs some preliminary processing on the video data and sends the video data to the hub device server system on behalf of the one or more cameras substantially in real time. In some implementations each camera has its own on board processing capabilities to perform some preliminary processing on the captured video data before sending the processed video data along with metadata obtained through the preliminary processing to the controller device and or the hub device server system .

In some implementations a camera of a video source captures video at a first resolution e.g. 720P and or 1080P and or a first frame rate 24 frames per second and sends the captured video to the hub device server system at both the first resolution e.g. the original capture resolution s the high quality resolution s such as 1080P and or 720P and the first frame rate and at a second different resolution e.g. 180P and or a second frame rate e.g. 5 frames per second or 10 frames per second . For example the camera captures a video at 720P and or 1080P resolution the camera may capture a video at 1080P and create a downscaled 720P version or capture at both 720P and 1080P . The video source creates a second or third rescaled and optionally at a different frame rate than the version version of the captured video at 180P resolution and transmits both the original captured version i.e. 1080P and or 720P and the rescaled version i.e. the 180P version to the hub device server system for storage. In some implementations the rescaled version has a lower resolution and optionally a lower frame rate than the original captured video. The hub device server system transmits the original captured version or the rescaled version to a client depending on the context. For example the hub device server system transmits the rescaled version when transmitting multiple videos to the same client device for concurrent monitoring by the user and transmits the original captured version in other contexts. In some implementations the hub device server system downscales the original captured version to a lower resolution and transmits the downscaled version.

In some other implementations a camera of a video source captures video at a first resolution e.g. 720P and or 1080P and or a first frame rate and sends the captured video to the hub device server system at the first resolution e.g. the original capture resolution s the high quality resolution s such as 1080P and or 720P and first frame rate for storage. When the hub device server system transmits the video to a client device the hub device server system may downscale the video to a second lower resolution e.g. 180P and or second lower frame rate for the transmission depending on the context. For example the hub device server system transmits the downscaled version when transmitting multiple videos to the same client device for concurrent monitoring by the user and transmits the original captured version in other contexts. In some implementations the camera operates in two modes a Day mode in which there is enough ambient light to capture color video of a scene and a Night mode in which the camera captures video of a scene using onboard LED illumination when there is not enough ambient light e.g. as described in the cross referenced U.S. patent application Ser. No. 14 723 276 filed on May 27 2015 entitled Multi mode LED Illumination System. . As described herein in some implementations the camera includes a program module that decides when to switch from Night mode to Day mode using one or more of illuminant detection detecting the type of ambient light based on R G and B G component ratios of the ambient light lux detection detecting the ambient light level and tiling performing illuminant detection and or lux detection for sub regions of an image sensor array so as to detect localized point light source that only impact a portion of the image sensor array .

As shown in in accordance with some implementations each of the client devices includes a client side module . The client side module communicates with a server side module executed on the hub device server system through the one or more networks . The client side module provides client side functionalities for the event monitoring and review processing and communications with the server side module . The server side module provides server side functionalities for event monitoring and review processing for any number of client side modules each residing on a respective client device . The server side module also provides server side functionalities for video processing and camera control for any number of the video sources including any number of control devices and the cameras .

In some implementations the server side module includes one or more processors a video storage database device and account databases an I O interface to one or more client devices and an I O interface to one or more video sources . The I O interface to one or more clients facilitates the client facing input and output processing for the server side module . In some implementations the I O interface to clients or a transcoding proxy computer not shown rescales e.g. downscales and or changes the frame rate of video for transmission to a client . The databases store a plurality of profiles for reviewer accounts registered with the video processing server where a respective user profile includes account credentials for a respective reviewer account and one or more video sources linked to the respective reviewer account. The I O interface to one or more video sources facilitates communications with one or more video sources e.g. groups of one or more cameras and associated controller devices . The video storage database stores raw video data received from the video sources as well as various types of metadata such as motion events event categories event category models event filters and event masks for use in data processing for event monitoring and review for each reviewer account.

In some implementations the server side module receives information regarding alert events detected by other smart devices e.g. hazards sound vibration motion . In accordance with the alert event information the server side module instructs one or more video sources in the smart home environment where the alert event is detected to capture video and or associate with the alert event video received from the video sources in the same smart home environment that is contemporaneous or proximate in time with the alert event.

Examples of a representative client device include but are not limited to a handheld computer a wearable computing device a personal digital assistant PDA a tablet computer a laptop computer a desktop computer a cellular telephone a smart phone an enhanced general packet radio service EGPRS mobile phone a media player a navigation device a game console a television a remote control a point of sale POS terminal vehicle mounted computer an ebook reader or a combination of any two or more of these data processing devices or other data processing devices. For example client devices and are a smart phone a tablet computer and a laptop computer respectively.

Examples of the one or more networks include local area networks LAN and wide area networks WAN such as the Internet. The one or more networks are optionally implemented using any known network protocol including various wired or wireless protocols such as Ethernet Universal Serial Bus USB FIREWIRE Long Term Evolution LTE Global System for Mobile Communications GSM Enhanced Data GSM Environment EDGE code division multiple access CDMA time division multiple access TDMA Bluetooth Wi Fi voice over Internet Protocol VoIP Wi MAX or any other suitable communication protocol.

In some implementations the hub device server system is implemented on one or more standalone data processing apparatuses or a distributed network of computers. In some implementations the hub device server system also employs various virtual devices and or services of third party service providers e.g. third party cloud service providers to provide the underlying computing resources and or infrastructure resources of the hub device server system . In some implementations the hub device server system includes but is not limited to a handheld computer a tablet computer a laptop computer a desktop computer or a combination of any two or more of these data processing devices or other data processing devices.

The server client environment shown in includes both a client side portion e.g. the client side module and a server side portion e.g. the server side module . The division of functionalities between the client and server portions of operating environment can vary in different implementations. Similarly the division of functionalities between the video source and the hub device server system can vary in different implementations. For example in some implementations client side module is a thin client that provides only user facing input and output processing functions and delegates all other data processing functionalities to a backend server e.g. the hub device server system . Similarly in some implementations a respective one of the video sources is a simple video capturing device that continuously captures and streams video data to the hub device server system with no or limited local preliminary processing on the video data. Although many aspects of the present technology are described from the perspective of the hub device server system the corresponding actions performed by the client device and or the video sources would be apparent to ones skilled in the art without any creative efforts. Similarly some aspects of the present technology may be described from the perspective of the client device or the video source and the corresponding actions performed by the video server would be apparent to ones skilled in the art without any creative efforts. Furthermore some aspects of the present technology may be performed by the hub device server system the client device and the video sources cooperatively.

It should be understood that operating environment that involves the hub device server system the video sources and the video cameras is merely an example. Many aspects of operating environment are generally applicable in other operating environments in which a server system provides data processing for monitoring and facilitating review of data captured by other types of electronic devices e.g. smart thermostats smart hazard detectors smart doorbells smart wall plugs appliances and the like .

The electronic devices the client devices or the server system communicate with each other using the one or more communication networks . In an example smart home environment two or more devices e.g. the network interface device the hub device and the client devices are located in close proximity to each other such that they could be communicatively coupled in the same sub network A via wired connections a WLAN or a Bluetooth Personal Area Network PAN . The Bluetooth PAN is optionally established based on classical Bluetooth technology or Bluetooth Low Energy BLE technology. This smart home environment further includes one or more other radio communication networks B through which at least some of the electronic devices of the video sources exchange data with the hub device . Alternatively in some situations some of the electronic devices of the video sources communicate with the network interface device directly via the same sub network A that couples devices and . In some implementations e.g. in the network C both the client device and the electronic devices of the video sources communicate directly via the network s without passing the network interface device or the hub device .

In some implementations during normal operation the network interface device and the hub device communicate with each other to form a network gateway through which data are exchanged with the electronic device of the video sources . As explained above the network interface device and the hub device optionally communicate with each other via a sub network A.

In some implementations the hub device is omitted and the functionality of the hub device is performed by the hub device server system video server system or smart home provider server system .

In some implementations the hub device server system is or includes a dedicated video processing server. illustrates a representative operating environment in which a video server system serves as a dedicated video processing server and provides data processing for monitoring and facilitating review of alert events e.g. motion events in video streams captured by video cameras . As shown in the video server system receives video data from video sources including cameras located at various physical locations e.g. inside homes restaurants stores streets parking lots and or the smart home environments of . Each video source may be bound to one or more user e.g. reviewer accounts and the video server system provides video monitoring data for the video source to client devices associated with the reviewer accounts. For example the portable electronic device is an example of the client device .

In some implementations the smart home provider server system or a component thereof serves as the video server system the video server system is a part or component of the smart home provider server system . In some implementations the video server system is separate from the smart home provider server system and provides video processing services to video sources and client devices independent of other services provided by the smart home provider server system . In some implementations the smart home provider server system and the video server system are separate but communicate information with each other to provide functionality to users. For example a detection of a hazard may be communicated by the smart home provider server system to the video server system and the video server system in accordance with the communication regarding the detection of the hazard records processes and or provides video associated with the detected hazard.

In some implementations each of the video sources includes one or more video cameras that capture video and send the captured video to the video server system substantially in real time. In some implementations each of the video sources optionally includes a controller device not shown that serves as an intermediary between the one or more cameras and the video server system . The controller device receives the video data from the one or more cameras optionally performs some preliminary processing on the video data and sends the video data to the video server system on behalf of the one or more cameras substantially in real time. In some implementations each camera has its own on board processing capabilities to perform some preliminary processing on the captured video data before sending the processed video data along with metadata obtained through the preliminary processing to the controller device and or the video server system .

In some implementations a camera of a video source captures video at a first resolution e.g. 720P and or 1080P and or a first frame rate 24 frames per second and sends the captured video to the video server system at both the first resolution e.g. the original capture resolution s the high quality resolution s and the first frame rate and a second different resolution e.g. 180P and or a second frame rate e.g. 5 frames per second or 10 frames per second . For example the camera captures a video at 720P and or 1080P resolution the camera may capture a video at 1080P and create a downscaled 720P version or capture at both 720P and 1080P . The video source creates a second or third rescaled and optionally at a different frame rate than the version version of the captured video at 180P resolution and transmits both the original captured version i.e. 1080P and or 720P and the rescaled version i.e. the 180P version to the video server system for storage. In some implementations the rescaled version has a lower resolution and optionally a lower frame rate than the original captured video. The video server system transmits the original captured version or the rescaled version to a client depending on the context. For example the video server system transmits the rescaled version when transmitting multiple videos to the same client device for concurrent monitoring by the user and transmits the original captured version in other contexts. In some implementations the video server system downscales the original captured version to a lower resolution and transmits the downscaled version.

In some other implementations a camera of a video source captures video at a first resolution e.g. 720P and or 1080P and or a first frame rate and sends the captured video to the video server system at the first resolution e.g. the original capture resolution s the high quality resolution s such as 1080P and or 720P and the first fame rate for storage. When the video server system transmits the video to a client device the video server system may downscale the video to a second lower resolution e.g. 180P and or second lower frame rate for the transmission depending on the context. For example the video server system transmits the downscaled version when transmitting multiple videos to the same client device for concurrent monitoring by the user and transmits the original captured version in other contexts.

As shown in in accordance with some implementations each of the client devices includes a client side module . The client side module communicates with the video server system through the one or more networks . In some implementations the video server system includes a video server a client interface server and a camera interface server . In some implementations the video server includes the server side module and its components and modules or one or more respective components and or modules of the server side module . The client side module provides client side functionalities for the event monitoring and review processing and communications with the video server system . The video server system provides server side functionalities for event monitoring and review processing for any number of client side modules each residing on a respective client device . The video server system also provides server side functionalities for video processing and camera control for any number of the video sources including any number of control devices and the cameras .

In some implementations the video server includes one or more processors a video storage database and device and account databases . In some implementations the video server system also includes a client interface server and a camera interface server . The client interface server provides an I O interface to one or more client devices and the camera interface server provides an I O interface to one or more video sources . The client interface server facilitates the client facing input and output processing for the video server system . For example the client interface server generates web pages for reviewing and monitoring video captured by the video sources in a web browser application at a client . In some implementations the client interface server or a transcoding proxy computer rescales e.g. downscales and or changes the frame rate of video for transmission to a client . In some implementations the client interface server also serves as the transcoding proxy. The databases store a plurality of profiles for reviewer accounts registered with the video processing server where a respective user profile includes account credentials for a respective reviewer account and one or more video sources linked to the respective reviewer account. The camera interface server facilitates communications with one or more video sources e.g. groups of one or more cameras and associated controller devices . The video storage database stores raw video data received from the video sources as well as various types of metadata such as motion events event categories event category models event filters event masks alert events and camera histories for use in data processing for event monitoring and review for each reviewer account.

In some implementations the video server system receives information regarding alert events detected by other smart devices e.g. hazards sound vibration motion. In accordance with the alert event information the video server system instructs one or more video sources in the smart home environment where the alert event is detected to capture video and or associate with the alert event video received from the video sources in the same smart home environment that is contemporaneous or proximate in time with the alert event.

Examples of a representative client device include but are not limited to a handheld computer a wearable computing device a personal digital assistant PDA a tablet computer a laptop computer a desktop computer a cellular telephone a smart phone an enhanced general packet radio service EGPRS mobile phone a media player a navigation device a game console a television a remote control a point of sale POS terminal vehicle mounted computer an ebook reader or a combination of any two or more of these data processing devices or other data processing devices. For example client devices and are a smart phone a tablet computer and a laptop computer respectively.

Examples of the one or more networks include local area networks LAN and wide area networks WAN such as the Internet. The one or more networks are optionally implemented using any known network protocol including various wired or wireless protocols such as Ethernet Universal Serial Bus USB FIREWIRE Long Term Evolution LTE Global System for Mobile Communications GSM Enhanced Data GSM Environment EDGE code division multiple access CDMA time division multiple access TDMA Bluetooth Wi Fi voice over Internet Protocol VoIP Wi MAX or any other suitable communication protocol.

In some implementations the video server system is implemented on one or more standalone data processing apparatuses or a distributed network of computers. In some implementations the video server the client interface server and the camera interface server are each respectively implemented on one or more standalone data processing apparatuses or a distributed network of computers. In some implementations the video server system also employs various virtual devices and or services of third party service providers e.g. third party cloud service providers to provide the underlying computing resources and or infrastructure resources of the video server system . In some implementations the video server system includes but is not limited to a handheld computer a tablet computer a laptop computer a desktop computer or a combination of any two or more of these data processing devices or other data processing devices.

The server client environment shown in includes both a client side portion e.g. the client side module and a server side portion e.g. the components and modules in the video server system . The division of functionalities between the client and server portions of operating environment can vary in different implementations. Similarly the division of functionalities between the video source and the video server system can vary in different implementations. For example in some implementations client side module is a thin client that provides only user facing input and output processing functions and delegates all other data processing functionalities to a backend server e.g. the video server system . Similarly in some implementations a respective one of the video sources is a simple video capturing device that continuously captures and streams video data to the video server system with no or limited local preliminary processing on the video data. Although many aspects of the present technology are described from the perspective of the video server system the corresponding actions performed by the client device and or the video sources would be apparent to ones skilled in the art without any creative efforts. Similarly some aspects of the present technology may be described from the perspective of the client device or the video source and the corresponding actions performed by the video server would be apparent to ones skilled in the art without any creative efforts. Furthermore some aspects of the present technology may be performed by the video server system the client device and the video sources cooperatively.

It should be understood that operating environment that involves the video server system the video sources and the video cameras is merely an example. Many aspects of operating environment are generally applicable in other operating environments in which a server system provides data processing for monitoring and facilitating review of data captured by other types of electronic devices e.g. smart thermostats smart hazard detectors smart doorbells smart wall plugs appliances and the like .

The electronic devices the client devices or the server system communicate with each other using the one or more communication networks . In an example smart home environment two or more devices e.g. the network interface device the hub device and the client devices are located in close proximity to each other such that they could be communicatively coupled in the same sub network A via wired connections a WLAN or a Bluetooth Personal Area Network PAN . The Bluetooth PAN is optionally established based on classical Bluetooth technology or Bluetooth Low Energy BLE technology. This smart home environment further includes one or more other radio communication networks B through which at least some of the electronic devices of the video sources exchange data with the hub device . Alternatively in some situations some of the electronic devices of the video sources communicate with the network interface device directly via the same sub network A that couples devices and . In some implementations e.g. in the network C both the client device and the electronic devices of the video sources communicate directly via the network s without passing the network interface device or the hub device .

In some implementations during normal operation the network interface device and the hub device communicate with each other to form a network gateway through which data are exchanged with the electronic device of the video sources . As explained above the network interface device and the hub device optionally communicate with each other via a sub network A.

In some implementations a video source may be private e.g. its captured videos and history are accessible only to the associated user account public e.g. its captured videos and history are accessible by anyone or shared e.g. its captured videos and history are accessible only to the associated user account and other specific users accounts with whom the associated user has authorized access e.g. by sharing with the other specific users . Whether a video source is private public or shared is configurable by the associated user.

In some implementations the camera also performs preliminary motion detection on video captured by the camera . For example the camera analyzes the captured video for significant changes in pixels. When motion is detected by the preliminary motion detection the camera transmits information to the hub device server system or video server system informing the server system of the preliminary detected motion. The hub device server system or video server system in accordance with the information of the detected motion may activate sending of a motion detection notification to a client device log the preliminary detected motion as an alert event and or perform additional analysis of the captured video to confirm and or classify the preliminary detected motion.

The hub device optionally includes one or more built in sensors not shown including for example one or more thermal radiation sensors ambient temperature sensors humidity sensors IR sensors occupancy sensors e.g. using RFID sensors ambient light sensors motion detectors accelerometers and or gyroscopes.

The radios enables one or more radio communication networks in the smart home environments and allows a hub device to communicate with smart devices. In some implementations the radios are capable of data communications using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. custom or standard wired protocols e.g. Ethernet HomePlug etc. and or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

Communication interfaces include for example hardware capable of data communications using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. and or any of a variety of custom or standard wired protocols e.g. Ethernet HomePlug etc. or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

Memory includes high speed random access memory such as DRAM SRAM DDR RAM or other random access solid state memory devices and optionally includes non volatile memory such as one or more magnetic disk storage devices one or more optical disk storage devices one or more flash memory devices or one or more other non volatile solid state storage devices. Memory or alternatively the non volatile memory within memory includes a non transitory computer readable storage medium. In some implementations memory or the non transitory computer readable storage medium of memory stores the following programs modules and data structures or a subset or superset thereof 

Each of the above identified elements e.g. modules stored in memory of hub device may be stored in one or more of the previously mentioned memory devices e.g. the memory of any of the smart devices in smart home environment and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Video data stored in the video storage database includes high quality versions and low quality versions of videos associated with each of the video sources . High quality video includes video in relatively high resolutions e.g. 720P and or 1080P and relatively high frame rates e.g. 24 frames per second . Low quality video includes video in relatively low resolutions e.g. 180P and relatively low frame rates e.g. 5 frames per second 10 frames per second .

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

In some implementations at least some of the functions of the video server client interface server and camera interface server are performed by the hub device server system and the corresponding modules and sub modules of these functions may be included in the hub device server system . In some implementations at least some of the functions of the hub device server system are performed by the video server client interface server and or camera interface server and the corresponding modules and sub modules of these functions may be included in the video server client interface server and or camera interface server .

Memory includes high speed random access memory such as DRAM SRAM DDR RAM or other random access solid state memory devices and optionally includes non volatile memory such as one or more magnetic disk storage devices one or more optical disk storage devices one or more flash memory devices or one or more other non volatile solid state storage devices. Memory optionally includes one or more storage devices remotely located from one or more processing units . Memory or alternatively the non volatile memory within memory includes a non transitory computer readable storage medium. In some implementations memory or the non transitory computer readable storage medium of memory stores the following programs modules and data structures or a subset or superset thereof 

Video data cache includes cached video image data for respective cameras associated with a user of the client device . For example as shown in the video data cache includes cached video image data for a first camera cached video image data for a second camera up to cached video image data for a p th camera. At a given moment video data cache may not have cached video image data for a given camera e.g. due to the camera being newly associated with the user due to the cache being cleared due to the cached video image data being expired and removed from the cache .

Blurred image data includes sets of progressively blurred images for respective cameras. For example as shown in the blurred image data includes blurred image data e.g. a set of progressively blurred images for the first camera blurred image data for the second camera up to blurred image data for the p th camera.

In some implementations the client device caches camera history as well as video data . For example whenever the client device receives camera events history data from the video server the most recent camera events history e.g. history from the past two hours the most recent 20 events is cached at the client device e.g. in client data . This cached history data may be accessed for quick display of camera history information e.g. in user interface .

In some implementations the client side module and user interface module are parts modules or components of a particular application e.g. a smart home management application .

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures modules or data structures and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

In some implementations at least some of the functions of the hub device server system or the video server system are performed by the client device and the corresponding sub modules of these functions may be located within the client device rather than the hub device server system or video server system . In some implementations at least some of the functions of the client device are performed by the hub device server system or video server system and the corresponding sub modules of these functions may be located within the hub device server system or video server system rather than the client device . The client device and the hub device server system or video server system shown in respectively are merely illustrative and different configurations of the modules for implementing the functions described herein are possible in various implementations.

The built in sensors include for example one or more thermal radiation sensors ambient temperature sensors humidity sensors IR sensors occupancy sensors e.g. using RFID sensors ambient light sensors motion detectors accelerometers and or gyroscopes.

The radios enable one or more radio communication networks in the smart home environments and allow a smart device to communicate with other devices. In some implementations the radios are capable of data communications using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. custom or standard wired protocols e.g. Ethernet HomePlug etc. and or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

Communication interfaces include for example hardware capable of data communications using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. and or any of a variety of custom or standard wired protocols e.g. Ethernet HomePlug etc. or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

Memory includes high speed random access memory such as DRAM SRAM DDR RAM or other random access solid state memory devices and optionally includes non volatile memory such as one or more magnetic disk storage devices one or more optical disk storage devices one or more flash memory devices or one or more other non volatile solid state storage devices. Memory or alternatively the non volatile memory within memory includes a non transitory computer readable storage medium. In some implementations memory or the non transitory computer readable storage medium of memory stores the following programs modules and data structures or a subset or superset thereof 

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Communication interfaces include for example hardware capable of data communications using any of a variety of custom or standard wireless protocols e.g. IEEE 802.15.4 Wi Fi ZigBee 6LoWPAN Thread Z Wave Bluetooth Smart ISA100.11a WirelessHART MiWi etc. and or any of a variety of custom or standard wired protocols e.g. Ethernet HomePlug etc. or any other suitable communication protocol including communication protocols not yet developed as of the filing date of this document.

Memory includes high speed random access memory such as DRAM SRAM DDR RAM or other random access solid state memory devices and optionally includes non volatile memory such as one or more magnetic disk storage devices one or more optical disk storage devices one or more flash memory devices or one or more other non volatile solid state storage devices. Memory or alternatively the non volatile memory within memory includes a non transitory computer readable storage medium. In some implementations memory or the non transitory computer readable storage medium of memory stores the following programs modules and data structures or a subset or superset thereof 

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above. Additionally camera being an example of a smart device optionally includes components and modules included in smart device as shown in that are not shown in .

In some implementations the camera captures surveillance video using a digital imaging system. Digital images frames are captured as a sequence at a particular frame rate compressed and then sent to the cloud e.g. the hub device server system or the video server system for storage and retrieval. In some implementations each frame e.g. the raw sensor data is composed of 1280 by 720 pixels 1280 720 and each pixel location has 3 color components red green and blue. The camera operates in one of two modes e.g. indicated by the Day Night mode value depending on the ambient lighting conditions. Day mode is used when there is sufficient ambient light to adequately illuminate the scene. Night mode is used when there is not enough light to adequately illuminate the scene.

In some implementations when operating in Day mode the camera uses the ambient lighting sources to illuminate the scene and capture surveillance video. In some implementations the minimum lux level at which the camera captures video in Day mode is between 0.1 to 1 lux depending on the color temperature of the dominant illuminant. Once the minimum lux level is reached the camera automatically switches to Night mode. Switching to Night mode includes mechanically disabling removing the IR filter and enabling a set of IR LEDs to provide illumination for the scene. Nightmode is maintained until the camera detects an external illuminant.

In an implementation of a prior mode switching technique described further with reference to the camera does detects an external illuminant by comparing the average maximum R G or B pixels to the minimum average R G or B pixels. The averages are calculated over a majority of the image. By comparing max to min values to a threshold it can be determined whether or not an external illuminant is present at a minimal lux level. Unfortunately the lux level at which switching occurs varies with the color temperature of the illuminant thus with this prior mode switching method there are scenes in which switching occurs too early negating any hysteresis available and resulting in oscillations between Day mode and Night mode. Additionally some illuminants are not detected at all resulting in the camera never switching from Night mode to Day mode.

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various implementations. In some implementations memory optionally stores a subset of the modules and data structures identified above. Furthermore memory optionally stores additional modules and data structures not described above.

Furthermore in some implementations the functions of any of the devices and systems described herein e.g. hub device hub device server system video server system client device smart device camera smart home provider server system are interchangeable with one another and may be performed by any other devices or systems where the corresponding sub modules of these functions may additionally and or alternatively be located within and executed by any of the devices and systems. As one example generating of user interfaces may be performed by the user interface module which may be located at the client interface server or at the video server or by the user interface module depending on whether the user is accessing the video feeds and corresponding histories through a web browser or an application e.g. a dedicated smart home management application at the client device . The devices and systems shown in and described with respect to are merely illustrative and different configurations of the modules for implementing the functions described herein are possible in various implementations.

As mentioned above in some implementations a camera utilizes a combination of illuminant detection lux level detection and tiling to determine when to switch from Night mode to Day mode. In some implementations one or more of these evaluations operations are performed by the mode control program module which subsequent to the determination initiates a switch from Night mode to Day mode if justified by the evaluations operations.

Illuminant detection involves determining the type of primary light source that is illuminating a scene or a portion of a scene captured by the camera . During development of the systems and method described herein experiments were performed to measure in Night mode specific combinations of red R green G and blue B color components and lux associated with different light source types lighting conditions at different distances from the camera . All measurements were normalized to IR only against a flat white reflective service and R G and B G plotted for the different light source types.

The light source types lighting conditions that were evaluated represent the wide range of light source types that might be found in environments e.g. home office retail business where security cameras are installed including 

The resulting measurements are shown in which is a graph of RIG vs. B G ratios for the different lighting conditions identified above. The graph legend identifies the marks used to indicate the type of light source lighting condition associated with the different measurements. The graph in shows that it is possible to identify when a scene is being illuminated solely by IR light e.g. see the boxed in cluster of marks associated with 0 lux measurements which are located near the intersection of R G 1 and B G 1 . In some implementations different light source types lighting conditions can be evaluated in a similar manner to identify color temperature characteristics associated with different relevant light source types for different environments. Similarly in some implementations different functions of color components e.g. not just R G and B G ratios can be used to evaluate color temperature characteristics of different light source types. That said it is particularly effective to use R G and B G ratios since those values are provided automatically by the AWB processing module as part of auto white balance AWB processing performed in most digital cameras.

In some implementations identifying the color temperature of the light source illuminant detection described above that is dominating the scene is only one part of determining whether or not to switch to Day mode. Some implementations also determine how much ambient light is available i.e. what is the lux level of the ambient light. In some implementations this is done by detecting the analog gain being applied to the image. e.g. the gain applied to image sensor measurements . In some implementations analog gain has a range of 0 db to 36 db. In some implementations in Night mode the frame rate can be 7.5 15 or 30 frames per second fps . Going from 30 fps to 15 fps is equivalent to a 6 db increase in analog gain similarly going from 15 fps to 7.5 fps corresponds to another 6 db increase in analog gain. This is similar to the direct relationship between the sensitivity of an image sensor and slower shutter speeds . Therefore some implementations normalize analog gain to 30 fps then compare the current analog gain to a threshold in order to determine if there is sufficient light to afford enough hysteresis to switch from Night mode to Day mode. For example some implementations switch from Night mode to Day mode at a higher lux level than from Day mode to Night mode this is to prevent the camera from switching back to the prior mode e.g. switching back to Night mode immediately following a mode switch to Day mode . During experimental testing described above with respect to it was found that certain light sources e.g. Christmas lights incandescent lights and shady sunlight have very high IR components and since these measurements are being made in Nightmode i.e. when there is no IR filter those IR components cause the apparent lux level to appear to be very high even though the visible light was quite low. In order to address this issue some implementations turn once again to illuminant detection to help determine the analog gain threshold at which we will switch from Night mode to Daymode.

In some implementations of Night mode to Day mode switching methods one or more lookup tables e.g. the lookup tables are used to represent the graphs of so as to enable the camera to efficiently identify lighting conditions for light received at all or a portion of the image sensor array based on R G and B G ratios i.e. the indices into the one or more lookup tables of the received light. In some implementations other methods can also be used to represent the graphs of .

Illuminant detection can be applied to an entire image or to any portion of an image. By breaking up an image into tiles it is possible to determine if a particular illuminant is predominantly occurring in only a small portion of the image and therefore does not warrant a Nigh mode to Day mode switch. This is especially useful in detecting point sources of light e.g. flashlights . Advantages of a tiling approach as compared to a non tiling approach are illustrated in which show the very different video images produced by two identical cameras using different methods to decide when to switch from Night mode to Day mode.

Examples of the All lights lookup table LUT and the Sunlight incandescent lookup table LUT are shown in in accordance with some implementations. These tables correspond to the graphs shown in but are structured as lookup tables to permit efficient implementation of illuminant detection as part of the described methods. Referring to in some implementations the All lights lookup table is populated with 1 s except for a small region populated with 0 s located near the intersection of B G 1 and R G 1 which is associated with 0 lux or pure IR illuminants. The region of this table indicates ranges of B G and R G ratios associated with illuminants that are sunlight or incandescent light. Performing a lookup into the All lights lookup table using a pair of B G and R G ratios for an associated sensor region converted to appropriately scaled integers as indices into the table will return 0 for 0 lux illuminants and 1 for other than pure IR illuminants to indicate the predominant illuminant type for that sensor region. Referring to in some implementations the Sunlight lookup table is a higher resolution representation of the sunlight incandescent region of . The Sunlight lookup table is populated with 1 s for ranges of B G and R G associated with sunlight and incandescent illuminants and 0 s elsewhere e.g. for all other illuminant types . The higher resolution representation of the sunlight incandescent region enables fine distinctions to be made between the color profiles e.g. color component ratios of sunlight incandescent illuminants which require higher lux levels for switching to Day mode and other illuminants with similar color profiles which require default lower lux levels for switching to Day mode. Performing a lookup into this table using a pair of B G and R G ratios for an associated sensor region converted to appropriately scaled integers as indices into the table will return 0 for sunlight and incandescent illuminants and 1 for other types of illuminants to indicate the predominant illuminant type for that sensor region. As noted above the lookup tables illustrated in are examples used in some implementations. Other implementations can employ one or more lookup tables for the same purpose e.g. a single lookup table with enough resolution to accurately identify illuminants that have color characteristics of sunlight or incandescent lights can use values other than 0 and 1 to represent regions of interest e.g. sunlight and 0 lux regions can be structured differently e.g. as other than 2 dimensional tables and can be accessed using different indices e.g. raw R G and B components instead of color component ratios .

The method presumes a tiling approach in which illuminant and lux detection operations are performed for each of plurality of tiles that collectively compose the sensor . The method can also be applied to implementations where the sensor is not tiled in which case the number of tiles num tiles referred to in the method equals 1 .

As described above in some implementations sensor gain is normalized so measured analog sensor gain can be compared to predefined switching thresholds. E.g. in some implementations sensor gain is normalized to a particular frame rate e.g. 30 fps .

In some implementations the method optionally adjusts power of the onboard IR LEDs as function of normalized analog gain i.e. lux level . In particular if the measured lux level is low IR LED Power is increased if the measured lux level is high then IR LED power is decreased. In some implementations illuminant detection is not performed until the IR LED power is 1 100th of the max IR LED power indicating that there is very little need for on board illumination of the scene .

As in initial step in illuminant detection RGB statistics e.g. ratios or raw component values are obtained for each tile or for the entire sensor array . In some implementations the RGB statistics are derived from the raw sensor data or the AWB data . The following operations are then performed for each tile as part of illuminant detection 

Having performed the above operations across all of the tiles or the entire image sensor array the total number of tiles illuminated by other than pure IR illuminants All lights sum is compared to a threshold number of tiles . In some implementations the threshold number of tiles is the total number of sensor tiles divided by 2 num tiles 2 . Other implementations can employ other thresholds. The total number of tiles illuminated by sunlight Sunlight sum is also compared to a threshold number of tiles . In some implementations the threshold number of tiles is the total number of tiles divided by 2 num tiles 2 . Other implementations can employ other thresholds.

If the total number of tiles illuminated by other than pure IR illuminants All lights sum and the total number of tiles illuminated by sunlight Sunlight sum are both less than the threshold Yes the camera will stay in Night mode . Otherwise the weighted total number of tiles illuminated by other than pure IR illuminants All lights sum 2 is compared to the total number of tiles illuminated by sunlight and incandescent light sources Sunlight sum . If the weighted total number of tiles illuminated by other than pure IR illuminants All lights sum 2 is greater than the total number of tiles illuminated by sunlight Sunlight sum Yes indicating that the predominant illuminant is not sunlight the maximum analog Gain Switch Threshold for switching to Day mode is set at a predefined default gain switch threshold . Otherwise No indicating that the predominant illuminant is sunlight the maximum analog Gain Switch Threshold for switching to Day mode is set at a predefined sunlight gain threshold which is lower than the default gain switch threshold . In the preceding discussion it is presumed that a higher analog sensor gain indicates a lower ambient light level i.e. less lux . Thus as described above when the predominant light source is sunlight or incandescent light more lux is required to enable switching to Day mode from Night mode.

The Gain Switch Threshold is then compared to the current analog sensor gain . If the analog sensor gain is less than or equal to the Gain Switch Threshold Yes the camera is switched to Day mode . Otherwise No the camera will stay in Night mode .

Referring to in some implementations the camera includes a controller memory storing instructions for execution by the controller a color sensor array comprising a plurality of sensor locations the sensor locations including first second and third pixels each having respective peak responses at different respective visible light frequencies and a lens assembly that is configured to focus light on the sensor array . When the camera mode is Night mode and the sensor is exposed to ambient light via the lens assembly the camera detects a first light component of the ambient light by averaging output signals from the first pixels detecting a second light component of the ambient light by averaging output signals from the second pixels detects a third light component of the ambient light by averaging output signals from the third pixels determines based on respective values of the first second and third light components whether the ambient light is due to other an IR light source and detects the ambient light level . Based on a determination that the ambient light is due to other than an IR light source and the ambient light level exceeds a first lux threshold the camera initiates a change of the camera mode to Day mode . Based on a determination that the ambient light is due to other than an IR light source and the ambient light threshold does not exceed the first lux threshold the camera mode is maintained in Night mode .

In some implementations the first second and third light components are red green and blue. In some implementations the camera includes a gain controller that adjusts analog gain of the sensor array based on the ambient light level such that detecting the ambient light level includes obtaining the analog gain of the sensor array. In some implementations the analog gain of the sensor varies with a frame rate of the camera such that the camera determines a first frame rate of the camera used to detect the first second and third light components and normalizes the obtained analog gain of the sensor based on a first difference between the first frame rate and a predefined frame rate and predefined associated differences in analog sensor gain based on the first difference. In some implementations the camera includes an IR filter with a first position in which it is interposed between the lens and the sensor array and a second position in which it is not interposed between the lens and sensor array such that as part of initiating a change of the camera mode to the day mode the camera switches the camera mode to the day mode and causes the IR filter to be moved from the second position to the first position.

Referring to in some implementations the camera determines based on values of the first second and third light components whether the ambient light is due to sunlight or an incandescent light source and based on a determination that the ambient light is due to sunlight or an incandescent light source initiates a change of the camera mode to the day mode only when the ambient light level exceeds a second lux threshold higher than the first lux threshold .

In some implementations the camera obtains a first ratio of the first to the second lighting components of the ambient light obtains a second ratio of the third to the second lighting components of the ambient light and obtains a graph characterizing respective types of light source based on a combination of the first and second ratios associated with the respective types of light sources the camera determines whether the ambient light is due to other than an IR light source e.g. as recited at step by determining based on the graph whether a light source characterized by the first ratio and the second ratio is other than an IR light source . In some implementations determining whether the ambient light is due to other than an IR light source includes determining that a point defined by the first ratio and the second ratio is substantially different from 1 1 . In some implementations the camera includes an auto white balance processor that provides the obtained first and second ratios.

In some implementations the graph identifies a first region defined by specific respective ranges of the first and the second ratios as being associated with sunlight or incandescent light sources the camera determines whether the ambient light is due to sunlight or an incandescent light source e.g. as recited at step by determining based on the graph whether a point defined by the first ratio and the second ratio lies within the first region .

In some implementations the graph is represented using two look up tables each addressable by a first index representing one of the first ratios and a second index representing one of the second ratios wherein a first one of the lookup tables defines combinations of the first and second ratios associated respectively with IR light sources and other than IR light sources and a second one of the lookup tables defines combinations of the first and second ratios associated with sunlight and incandescent lights .

Referring to in some implementations the first lookup table encodes with 1 s first table locations associated with other than IR light sources and with 0 s first table locations associated with IR light sources such that the first lookup table is almost entirely filled with all 1 s apart from table locations associated with pairs of first and second ratios substantially similar to 1.1 .

In some implementations the second lookup table corresponds to a higher resolution version of a sub region of the first lookup table wherein the second lookup table encodes with 1 s second table locations associated with sunlight and incandescent light sources and with 0 s second table locations associated with other than sunlight and incandescent light sources .

In some implementations the color sensor array is one tile of a plurality of tiles in a color sensor array system and the method of claim is performed for each of the tiles such that a respective mode change signal is generated for a respective tile for which the ambient light at that respective tile is due to other than an IR light source prior to initiating the change of the camera mode to the day mode in which the camera further determines a total number of the mode change signals for the color sensor array system determines whether the total number of the mode change signals exceeds a predetermined mode change threshold based on a total number of tiles in the color sensor array system and when the total number of the mode change signals exceeds the mode change threshold initiates the change of the camera mode to the day mode .

Although some of various drawings illustrate a number of logical stages in a particular order stages that are not order dependent may be reordered and other stages may be combined or broken out. While some reordering or other groupings are specifically mentioned others will be obvious to those of ordinary skill in the art so the ordering and groupings presented herein are not an exhaustive list of alternatives. Moreover it should be recognized that the stages could be implemented in hardware firmware software or any combination thereof.

The foregoing description for purpose of explanation has been described with reference to specific implementations. However the illustrative discussions above are not intended to be exhaustive or to limit the scope of the claims to the precise forms disclosed. Many modifications and variations are possible in view of the above teachings. The implementations were chosen in order to best explain the principles underlying the claims and their practical applications to thereby enable others skilled in the art to best use the implementations with various modifications as are suited to the particular uses contemplated.

